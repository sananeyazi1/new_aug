(function(G){var l=G("#main-container");var i=G("#nav");var r=l.find("#image-1");var A=l.find("#doping-timeline");var d=l.find(".sections");var P=d.find(".section");var J=i.find(".progress");var j=l.find(".oo-video");var R=l.find("#ride-graphic");var n=R.find("#canvas");var k,z;var H=G("body").hasClass("ie6")||G("body").hasClass("ie7")||G("body").hasClass("ie8")?true:false;var F=(!mobile_browser||ipad_browser)?true:false;var u;var N=false;var I=false;var y=false;var E=false;var x,w;var e;var b={c:110,e:916,h:190,p:500,v:18.8,s:18097,d:120156};var M={c:30,e:0,h:44,p:50,v:0};var q={v:2.238};var L=[[0,120156],[0,76928],[76929,86578],[99534,101277],[86579,120156]];ich.grabTemplates();G(document).ready(function(S){S(".lazy").show().lazyload({threshold:500,effect:"fadeIn"});S(".lazy").load(function(){if(S(this).hasClass("video")){o(S(this).attr("data-video"));S(this).siblings(".oo-video").addClass("loading");S(this).remove()}});function T(X,W){var U=W?W:0;var V=S(X).offset().top;N=true;y=true;S("html, body").animate({scrollTop:V-49},U,function(){N=false})}i.find(".title a").on("click",function(U){U.preventDefault();T(S(this).attr("href"),600);i.find(".active").removeClass("active");v("click","title")});i.find(".section a").on("click",function(U){U.preventDefault();S(this).parent().addClass("active").siblings(".section").removeClass("active");T(S(this).attr("href"));v("click",S(this).parent().index())});S("#mobile-nav").find("a").on("click",function(U){U.preventDefault();S(this).parent().addClass("active").siblings(".active").removeClass("active");l.children(".sections").children().addClass("mobile-inactive");l.find(S(this).attr("href")).removeClass("mobile-inactive");S(window).scrollTop(0);if(S(this).parent().index()===S("#mobile-nav").children("li").length-1){S(".credits").addClass("show-mobile")}else{S(".credits").removeClass("show-mobile")}});S("body").on("click",".related-content a",function(U){U.preventDefault();T(S(this).attr("href"))});i.find(".comment a").on("click",function(U){U.preventDefault();T(S(this).attr("href"));v("click","comments")});S(window).scroll(function(){var V=S(this).scrollTop();var U=S(this).height();O(V,U)});S(window).resize(function(){S.each(j,function(X,V){if(S(V).find("object").length>0){var U=S(V).width();var Y=U*9/16;var W={width:U,height:Y};S(V).find("object").attr(W);S(V).children(".innerWrapper").css(W);S(V).height(Y)}else{if(S(V).find("video").length>0){var U=S(V).width();var Y=U*9/16;var W={width:U,height:Y};S(V).children(".innerWrapper").css(W);S(V).height(Y)}}});f(function(){I=true;if(F){g()}},100,"timer-id")});if(F){p()}});function K(){if(mobile_browser&&!ipad_browser){l.find(".mobile-swap").each(function(U,T){var S=G(T).attr("data-original");var V=S.replace(".jpg","-mobile.jpg");G(T).attr("data-original",V)})}Q()}function Q(){var S=A.find(".tour-winners");G.each(timeline_data,function(V,Y){var U=Y.winner.split(" ");var T=U[U.length-1].toLowerCase();var X={classes:"winner"+Y.year+" "+Y.doped+" "+Y.stripped,name:Y.winner,fname:U[0],lname:U[1],img_slug:T==="armstrong"||T==="contador"?T+"-"+Y.year:T,year:Y.year,country:Y.counry};var W=ich.winnerProfile(X);S.append(W)})}function o(S){if(!!TWP.ooyala){G.getJSON("http://www.augusta.com/"+a[S-1]+"_jsn.json",function(U){var T=new TWP.ooyala.v3.Player({json:U,playerContainerId:"video"+(S),autoplay:0,adFreq:0.5});T.create()})}else{window.setTimeout(function(){o(S)},100)}}function p(){G.ajax({url:"http://www.augusta.com/abc.jsonp",cache:true,dataType:"jsonp",jsonpCallback:"getridedata",success:function(S){e=S;g()}});R.find(".stepper a").click(function(S){S.preventDefault();if(!G(this).hasClass("next")){G(this).parent().addClass("active").siblings(".active").removeClass("active");D()}});R.find(".graphic-nav a").click(function(T){var S=G(this).parent().index();if(G(this).hasClass("next")){var U=R.find(".graphic-nav").find(".active").index()+1;S=U===S?0:U;R.find(".graphic-nav a").eq(S).click();return false}R.find(".panel").eq(S).addClass("active").siblings(".active").removeClass("active");if(!I){embedWPAudioPlayer({container:"audioplayer",url:"http://www.augusta.com/wp-srv/special/sports/cycling/assets/audio"+S+".mp3",width:R.find("#audioplayer").width()});R.find(".audio-text").eq(S).addClass("active").siblings(".active").removeClass("active")}I=false});R.find(".map-btns a").click(function(T){T.preventDefault();var S=G(this).attr("data-btn");R.find(".graphic-nav a").eq(S).click()})}function g(){R.find("#views").css("margin-left",R.find("#sidebar").outerWidth());if(!H){m(z,n.siblings("#e-canvas"));n.html("").siblings("#e-canvas").html("");z=t("e-canvas",n.siblings("#e-canvas").width(),n.siblings("#e-canvas").height());var Z="M";var W=n.height();var U=n.width();var S=U/e.length;var T=b.e;var X=b.s;var Y=b.d;var V=0;z.beginPath();z.fillStyle="rgba(190, 190, 190, 1)";z.moveTo(0,W);G.each(e,function(ab,ac){if(ab>0&&Number(ac.e)>=0&&ac.e!==null){var aa=U*(Number(ac.d)/Y);var ad=W-(ac.e/T)*W;z.lineTo(aa,ad);V=Number(ac.d)}});z.fill();z.closePath()}R.find(".graphic-nav .active a").click();R.find(".canvas-labels").fadeTo(300,1)}function D(){var W=R.find(".graphic-nav .active").index();if(W>0){R.find(".map-btns a").eq(W-1).addClass("active").siblings(".active").removeClass("active");var ah=R.find("#map-img-"+W);R.find(".parts").append(ah);R.find(".parts").fadeTo(400,1);ah.fadeTo(400,1,function(){G(this).siblings("img").fadeTo(0,0)});R.find(".top-elevation").removeClass("bg")}else{R.find(".map-btns .active").removeClass("active");R.find(".parts").fadeTo(300,0);R.find(".top-elevation").addClass("bg")}if(!H){var ai=R.find(".stepper.stats .active a").attr("data-key");var S=R.find("#chart").attr("data-stat");R.find("#chart").attr("data-stat",ai);var ad=b[ai];var af=R.find(".y-axis");af.html("");for(var ae=0;ae<2;ae++){var ak=Math.round(ad/(ae+1));if(q[ai]){ak=Math.round(ad*q[ai]/(ae+1))}af.append('<div class="y-tick" style="top:'+Number(100-100/(ae+1))+'%"><p>'+ak+"</p></div>")}m(k,n);k=t("canvas",n.width(),n.height());var Z=L[W][1]-L[W][0];var V=n.width();var Y=b.s;var ab=b.d;var T=W===0?0:L[W][0]/ab*V;var U=W===0?0:(ab-L[W][1])/ab*V;var ac=L[W][1]/ab*100;R.find(".lpane").css({width:T});R.find(".rpane").css({width:U,left:ac+"%"});var X=2;var ag=n.height();var aa=M[ai];var aj=V/e.length;G.each(e,function(an,ao){var ap=ao[ai];if(Number(ap)>=0&&ap!==null){var al=V*(Number(ao.d)/ab);var aq=ag-(ap/ad)*ag;k.beginPath();var am="rgba(180, 180, 180, 0.45)";if(ao.d>=L[W][0]&&ao.d<=L[W][1]){am="rgba(0, 168, 255, 0.45)"}k.fillStyle=am;k.arc(al-X/2,aq-X/2,X,0,Math.PI*2,true);k.fill();k.closePath()}})}}function t(W,T,V){var X=l.find("#"+W);var U=document.createElement("canvas");X.append(U);if(typeof G_vmlCanvasManager!="undefined"){U=G_vmlCanvasManager.initElement(U)}var S=U.getContext("2d");S.canvas.width=T;S.canvas.height=V;return S}function m(T,S){S.html("");if(!!T){T.clearRect(0,0,S.width(),S.height())}}function O(Y,T){var V=r.offset().top+r.height()-i.height();var X=i.find(".title").css("text-indent");if(Y>V&&X==="-300px"){i.find(".title").stop().show().animate({"text-indent":0},300)}else{if(Y<V&&X==="0px"){i.find(".title").stop().animate({"text-indent":-300},300,function(){G(this).hide()})}}if(mobile_browser&&!ipad_browser){A.addClass("animate")}else{if(!A.hasClass("animate")){var U=A.offset().top+A.find(".graphic-box").height()-T;if(Y>U){A.addClass("animate")}else{A.removeClass("animate")}}}if(!N){var W=u;var S=false;G.each(P,function(Z,aa){var ab=G(aa).offset().top-50;if(Y<ab){if(Z===0){u=-1;S=true}return false}else{if(Y>=ab){W=Z}}});if(!!S){i.find(".sections").find(".active").removeClass("active")}else{if(W!==u){u=W;C()}}}J.css("width",(Y/(d.height()-T))*100+"%")}function h(){var V;var aa;var Y;var T=window;function Z(){T.removeEventListener("touchmove",S);T.removeEventListener("touchend",X);V=null;Y=null}function S(ad){if(ad.touches.length>1){Z()}else{var ab=ad.touches[0].pageY;var ac=ad.touches[0].pageY+G(window).height()-i.height();G.each(j,function(af,ae){var ag=G(ae).offset().top;if(G(ae).is(":visible")&&ag>=ab&&ag<=ac&&G(this).siblings(".video.lazy").length>0){var ah=G(ae).siblings(".video.lazy").attr("data-video");o(ah);G(ae).addClass("loading");G(ae).siblings(".video.lazy").remove()}})}}function X(ab){Z()}function U(ab){if(ab.touches.length==1){V=ab.touches[0].pageY;T.addEventListener("touchmove",S,false);T.addEventListener("touchend",X,false)}}try{T.addEventListener("touchstart",U,false)}catch(W){}}function C(){i.find(".section").eq(u).addClass("active").siblings(".section").removeClass("active");if(y){y=false}else{v("scroll",u+1)}}function v(U,Y){if(!!E){return false}if(U==="scroll"){E=true;window.setTimeout(function(){E=false},1500)}var S=document.location.pathname;var X=S.split("/");var T=X[X.length-2];try{var V=U==="click"?"event80":"event77";s.sendDataToOmniture(T,V,{eVar26:"sports_cycling_"+Y,eVar1:T})}catch(W){}}var f=(function(){var S={};return function(V,T,U){if(!U){U="Don't call this twice without a uniqueId"}if(S[U]){clearTimeout(S[U])}S[U]=setTimeout(V,T)}})();function B(S){return Math.round(Number(S)/1609.34*100)/100}String.prototype.toHHMMSS=function(){sec_numb=parseInt(this);var S=Math.floor(sec_numb/3600);var T=Math.floor((sec_numb-(S*3600))/60);var V=sec_numb-(S*3600)-(T*60);if(S<10){S=S}if(T<10){T="0"+T}if(V<10){V="0"+V}var U=S+":"+T+":"+V;return U};K()})(jQuery);