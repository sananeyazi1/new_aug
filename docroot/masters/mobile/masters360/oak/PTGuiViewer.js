/*
PTGuiViewer version 1.6

See below for usage instructions!

PTGui Panorama Viewer, a combined Flash10 / CSS3 / WebGL viewer for spherical panoramas. 
(C) Copyright New House Internet Services BV 2010 - 2011
Website: http://www.ptgui.com/

License Agreement for PTGui Panorama Viewer

The software program PTGui Panorama Viewer ("PTGuiViewer") is licensed, not 
sold. By copying, publishing or distributing PTGuiViewer you agree to be bound 
by the terms of this agreement. If you do not agree to the terms of this 
agreement, you are not permitted to copy, publish or distribute PTGuiViewer.

1. Grant of a Limited License 

New House Internet Services B.V. ("NHIS") grants you ("Licensee") a non-exclusive, 
non-transferable Limited License ("License"). The License permits Licensee to 
include the files PTGuiViewer.js and PTGuiViewer.swf on any number of websites, 
provided that all of the following conditions are satisfied: 
- PTGuiViewer may only be used to display panoramic images created with
PTGui panoramic stitching software ("PTGui") by a licensee of PTGui,  
and 
- PTGuiViewer.js and PTGuiViewer.swf may only be published unmodified, as 
released by NHIS 

2. Ownership.

You acknowledge that NHIS and its licensors retain ownership of PTGuiViewer. 
NHIS reserves any rights not expressly granted to you. The rights granted are 
limited to NHIS's and its licensors' intellectual property rights in 
PTGuiViewer and do not include any other patents or intellectual property 
rights.

3. Transfer Restriction

You may not transfer or assign your rights under this License Agreement to 
another party without NHIS's prior written consent.

4. Support

You are welcome to post technical support questions to the PTGui Support 
forum. However, this license does not obligate NHIS to provide technical 
support.

5. Limitations

YOU MAY NOT REVERSE ENGINEER, DECOMPILE OR DISASSEMBLE PTGUIVIEWER, EXCEPT AND 
ONLY TO THE EXTENT EXPRESSLY PERMITTED BY APPLICABLE LAW. YOU MAY NOT MODIFY, 
ADAPT, TRANSLATE, RENT, LEASE, LOAN OR CREATE DERIVATIVE WORKS BASED UPON 
PTGUIVIEWER OR ANY PART THEREOF.

6. Restricted Uses

PTGUIVIEWER IS NOT INTENDED FOR USE IN THE OPERATION OF NUCLEAR FACILITIES, 
AIRCRAFT NAVIGATION OR COMMUNICATION SYSTEMS, AIR TRAFFIC CONTROL SYSTEMS, 
LIFE SUPPORT MACHINES OR OTHER EQUIPMENT IN WHICH THE FAILURE OF PTGUIVIEWER 
COULD LEAD TO DEATH, PERSONAL INJURY, OR SEVERE PHYSICAL OR ENVIRONMENTAL 
DAMAGE.

7. Limited Warranty

NHIS warrants for a period of thirty (30) days from the date of purchase of 
your License that PTGuiViewer as provided by NHIS will perform substantially 
in accordance with the accompanying documentation. NHIS's entire liability and 
your sole and exclusive remedy for any breach of the foregoing limited 
warranty will be, at NHIS's option, replacement of PTGuiViewer, refund of the 
purchase price or repair or replacement of PTGuiViewer which is returned to 
NHIS or an NHIS authorized representative with a copy of the receipt. THIS 
LIMITED WARRANTY IS THE ONLY WARRANTY PROVIDED BY NHIS AND NHIS AND ITS 
LICENSORS EXPRESSLY DISCLAIM ALL OTHER WARRANTIES, CONDITIONS OR OTHER TERMS, 
EITHER EXPRESS OR IMPLIED (WHETHER COLLATERALLY, BY STATUTE OR OTHERWISE), 
INCLUDING BUT NOT LIMITED TO IMPLIED WARRANTIES, CONDITIONS OR OTHER TERMS OF 
MERCHANTABILITY, SATISFACTORY QUALITY AND/OR FITNESS FOR A PARTICULAR PURPOSE 
WITH REGARD TO PTGUIVIEWER AND ACCOMPANYING WRITTEN MATERIALS. FURTHERMORE, 
THERE IS NO WARRANTY AGAINST INTERFERENCE WITH YOUR ENJOYMENT OF PTGUIVIEWER 
OR AGAINST INFRINGEMENT OF THIRD PARTY PROPRIETARY RIGHTS BY PTGUIVIEWER. NHIS 
DOES NOT WARRANT THAT THE OPERATION OF PTGUIVIEWER WILL BE UNINTERRUPTED OR 
ERROR-FREE, OR THAT DEFECTS IN PTGUIVIEWER WILL BE CORRECTED. NO ORAL OR 
WRITTEN INFORMATION OR ADVICE GIVEN BY NHIS OR AN NHIS AUTHORIZED 
REPRESENTATIVE SHALL CREATE A WARRANTY. BECAUSE SOME JURISDICTIONS DO NOT 
ALLOW THE EXCLUSION OR LIMITATION OF IMPLIED WARRANTIES, CONDITIONS OR OTHER 
TERMS THE ABOVE LIMITATION MAY NOT APPLY TO YOU. THE TERMS OF THIS DISCLAIMER 
AND THE LIMITED WARRANTY UNDER THIS SECTION DO NOT AFFECT OR PREJUDICE THE 
STATUTORY RIGHTS OF A CONSUMER ACQUIRING PTGUIVIEWER OTHERWISE THAN IN THE 
COURSE OF A BUSINESS, NEITHER DO THEY LIMIT OR EXCLUDE ANY LIABILITY FOR DEATH 
OR PERSONAL INJURY CAUSED BY NHIS'S NEGLIGENCE.

8. Exclusion and Limitation of Remedies and Damages.

IN NO EVENT WILL NHIS, ITS PARENTS, SUBSIDIARIES, OR ANY OF THEIR LICENSORS, 
DIRECTORS, OFFICERS, EMPLOYEES OR AFFILIATES OF ANY OF THE FOREGOING BE LIABLE 
TO ANY OTHER PARTY FOR ANY CONSEQUENTIAL, INCIDENTAL, INDIRECT OR SPECIAL 
DAMAGES WHATSOEVER (INCLUDING WITHOUT LIMITATION, DAMAGES FOR LOSS OF BUSINESS 
PROFITS, BUSINESS INTERRUPTION, LOSS OF DATA, LOSS OF BUSINESS INFORMATION AND 
THE LIKE) OR DIRECT LOSS OF BUSINESS, BUSINESS PROFITS OR REVENUE, WHETHER 
FORESEEABLE OR UNFORESEEABLE, ARISING OUT OF THE USE OF OR INABILITY TO USE 
PTGUIVIEWER OR ACCOMPANYING WRITTEN MATERIALS, REGARDLESS OF THE BASIS OF THE 
CLAIM (WHETHER UNDER CONTRACT, NEGLIGENCE OR OTHER TORT OR UNDER STATUTE OR 
OTHERWISE HOWSOEVER ARISING) AND EVEN IF ADVISED OF THE POSSIBILITY OF SUCH 
DAMAGE.

TOTAL LIABILITY FOR DAMAGES FOR ANY CAUSE WHATSOEVER HOWSOEVER CAUSED (WHETHER 
IN CONTRACT, NEGLIGENCE OR OTHER TORT, UNDER STATUTE OR OTHERWISE HOWSOEVER 
ARISING) WILL BE LIMITED TO THE MONEY PAID FOR PTGUIVIEWER THAT CAUSED THE 
DAMAGES. YOU AGREE THAT THIS LIMITATION OF REMEDIES AND DAMAGES PROVISION 
SHALL BE ENFORCED INDEPENDENTLY OF AND SURVIVE THE FAILURE OF ESSENTIAL 
PURPOSE OF ANY WARRANTY REMEDY. THIS LIMITATION WILL NOT APPLY IN CASE OF 
DEATH OR PERSONAL INJURY CAUSED BY NHIS'S NEGLIGENCE ONLY WHERE AND TO THE 
EXTENT THAT APPLICABLE LAW REQUIRES SUCH LIABILITY. BECAUSE SOME JURISDICTIONS 
DO NOT ALLOW THE EXCLUSION OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR 
INCIDENTAL DAMAGES, THE LIMITATION OF LIABILITY IN THIS SECTION MAY NOT APPLY 
TO YOU. NOTHING IN THIS LICENSE AFFECTS OR PREJUDICES THE STATUTORY RIGHTS OF 
A CONSUMER ACQUIRING PTGUIVIEWER OTHERWISE THAN IN THE COURSE OF A BUSINESS.

9. General Terms

This License shall be governed by the laws of The Netherlands. Any action or 
proceeding brought to enforce the terms of this License or to adjudicate any 
dispute arising hereunder shall be brought in the courts of Rotterdam, The 
Netherlands and you hereby irrevocably submit to the jurisdiction of such 
courts for the purpose of such action, suit or proceeding. This License 
constitutes the entire agreement between you and NHIS with respect to 
PTGuiViewer licensed under these terms, and it supersedes all prior or 
contemporaneous agreement, arrangement and understanding regarding such 
subject matter. You acknowledge and agree that you have not relied on any 
representations made by NHIS, however, nothing in this License shall limit or 
exclude liability for any representation made fraudulently. No amendment to or 
modification of this License will be binding unless in writing and signed by 
NHIS. If any provision of this License shall be held by a court of competent 
jurisdiction to be contrary to law, that provision will be enforced to the 
maximum extent permissible, and the remaining provisions of this License will 
remain in full force and effect. No failure or delay by NHIS in exercising its 
rights or remedies shall operate as a waiver unless made by specific written 
notice. No single or partial exercise of any right or remedy of NHIS shall 
operate as a waiver or preclude any other or further exercise of that or any 
other right or remedy.

------------------------ USAGE: ------------------------

Quick start: include the following code in the <head> of your HTML file:


<script type="text/javascript" src="PTGuiViewer.js"></script>
<script type="text/javascript">
var viewer=new PTGuiViewer();
viewer.setSwfUrl("PTGuiViewer.swf");
viewer.preferHtmlViewer();
// or viewer.preferFlashViewer()
viewer.setVars({
  pano: "myimage",
  format: "14faces",
});
viewer.embed("mypanoviewer");
</script>

And in the <body> include:
<div id="mypanoviewer"></div>


The viewer will be embedded as child of the above <div>, and it will use the
images myimage00.jpg ... myimage14.jpg. 

Details:
viewer.setSwfUrl(url)
Point to the location of the accompanying file PTGuiViewer.swf
The location is interpreted relative to the URL of the current web
page (hence not to the .js location).

The PTGui Viewer supports 3 technologies: Flash10, CSS3D and WebGL. 
The Flash10 viewer is available on all browsers with the Flash version 10 plugin
installed. 
CSS3D works (as of feb 2011) on Apple's Safari 5 and IOS (iPhone/iPad/iPod).
WebGL is supported (as of feb 2011) on Chrome 9 and Firefox 4.  

viewer.preferHtmlViewer()
viewer.preferFlashViewer()
These functions determine which technology will be used if the browser supports 
both the native (CSS3D or WebGL) viewer and Flash10. 

viewer.setVars()
Pass an array with the following key/value pairs:
- pano (required): the relative url of the panoramic tiles. The viewer appends
the suffixes 00.jpg through 14.jpg.
- format (required): format of the panoramic tiles. Currently only the '14faces'
format is supported (as produced by PTGui). Future versions of the viewer may
support other formats, therefore this option is required for future 
compatibility.
- pan, tilt, fov: initial viewing parameters. Pan rotates in horizontal direction,
tilt is up/down. Fov is the diagonal field of view angle.
- maxpan, maxtilt, maxfov, minpan, mintilt, minfov: Maximum and minimum limits
for pan/tilt/fov.
- autorotatespeed: speed (in degrees per second) for automatic rotation. If set
to 0, autorotate is disabled. Autorotation starts immediately upon loading the
panorama and ends when the user clicks in the panorama.
- autorotatedelay: If nonzero, autorotation is resumed .. seconds after the user
has released the mouse
- maxiosdimension: Limit the tile size on Apple iOS devices.
If a too large panorama is shown on an iPad/iPhone/iPod, the Safari browser will
crash because it runs out of memory. This setting limits reduces the tile size
on these devices. The recommended (and default) value is 400. 
- showfullscreenbutton_flash: true or false
Sets whether the fullscreen button is visible in the Flash viewer
- showfullscreenbutton_html: true or false
Sets whether the fullscreen button is visible in the HTML viewer
(HTML viewer does not support true full screen viewing due to restrictions in the
HTML standard. Clicking the fullscreen button enlarges the viewer to the full
browser window size.)
- enablegyroscope: true or false
On devices with a gyroscope (iPhone 4 or iPad 2) the viewer can look around in
the panorama by rotating the device. Enabled or disabled by this setting.

viewer.setFlashObjectParams()
Allows adding custom parameters for the Flash object/embed tag. For example:
viewer.setFlashObjectParams({
  wmode: "opaque"
});
will add a <param name="wmode" value="opaque"> to the Flash <object> tag
and a parameter in the Flash <embed> tag: <embed ... wmode="opaque" ...>
Only used for the Flash viewer, ignored when using CSS3D or WebGL. 

viewer.embed(container)
Embeds the viewer as a child of the given container. All contents of the 
container element is cleared, and the viewer will make itself a child element
of the container.
The container can be either an html element object (as returned by 
document.getElementById) or a string representing the id of the container
element.
If embed() is called before the page has finished loading, the embedding
will be done as soon as the page has finished loading. So it is safe to call
embed() in a script in the <head> of the HTML page, passing the id of a container 
element that has not yet been created.

viewer.showInLightbox()
Pops up a 'lightbox' (a black window overlaying the entire browser window)
showing the panorama. The user can close the panorama and return to the page by 
pressing the red close button at the top left corner. This method is to be used 
instead of embed(), in response to a user action, for example:
<a href="#" onclick="viewer.showInLightbox(); return false;">view panorama</a>
In Internet Explorer the lightbox is shown correctly only when the page is 
rendered in HTML Strict mode. For compatibility with IE the following line 
should therefore be inserted at the top of the HTML page:
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 

-----------------------------------------------------------

*/

// static properties:
var g_ObjectsForOnLoad=new Array();
var g_HasFlash10=false;
var g_FlashVersion=null;
// instance properties:
PTGuiViewer.prototype.m_ViewerVars;
PTGuiViewer.prototype.m_FlashObjectParams;
PTGuiViewer.prototype.m_SwfUrl;
PTGuiViewer.prototype.m_ContainerForEmbedOnLoad=null;
PTGuiViewer.prototype.m_bodyLoaded=false;
PTGuiViewer.prototype.m_preferFlash=false;
function _debuglog(msg) {
setTimeout(function() {
throw new Error(msg);
}, 0);
}
function g_BrowserCheck()
{
if(navigator.plugins)
{
var flashobj=navigator.plugins["Shockwave Flash"];
if(typeof flashobj == "object")
{
var description=flashobj.description;
if(description)
{
var enabled=true;
if(navigator.mimeTypes)
{
if(navigator.mimeTypes["application/x-shockwave-flash"])
{
if(!navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)
{
enabled=false;
}
}
}
if(enabled)
{
description = description.replace(/^.*\s+(\S+\s+\S+$)/, "$1");
g_FlashVersion=new Array();
g_FlashVersion[0] = parseInt(description.replace(/^(.*)\..*$/, "$1"), 10);
g_FlashVersion[1] = parseInt(description.replace(/^.*\.(.*)\s.*$/, "$1"), 10);
g_FlashVersion[2] = /[a-zA-Z]/.test(description) ? parseInt(description.replace(/^.*[a-zA-Z]+(.*)$/, "$1"), 10) : 0;
}
}
}
}
if(!g_FlashVersion)
{
if(window.ActiveXObject)
{
try 
{
var a = new ActiveXObject("ShockwaveFlash.ShockwaveFlash");
if (a)
{
var description = a.GetVariable("$version");
if(description)
{
description = description.split(" ")[1].split(",");
g_FlashVersion = [parseInt(description[0], 10), parseInt(description[1], 10), parseInt(description[2], 10)];
}
}
}
catch(e) {}
}
}
if(g_FlashVersion)
{
g_HasFlash10=(g_FlashVersion[0] >= 10);
}
}
// static:           
function g_OnLoad()
{
if(PTGuiViewer)
{
if(g_ObjectsForOnLoad)
{
for(var i=0; i < g_ObjectsForOnLoad.length; i++)
{
g_ObjectsForOnLoad[i].bodyOnLoad();
}
g_ObjectsForOnLoad=null;
}
}
}
// register obj.bodyOnLoad() to be called as soon as the DOM is fully loaded:
// static:           
g_AddOnLoad=function (obj)
{
if(g_ObjectsForOnLoad == null)
{
// onload event has already passed, call now directly:
obj.bodyOnLoad();
}
else
{
g_ObjectsForOnLoad[g_ObjectsForOnLoad.length]=obj;
}
}
// initialization:
g_BrowserCheck();
if(window.addEventListener)
{
window.addEventListener("load", g_OnLoad, false);
}
else if(window.attachEvent)
{
window.attachEvent("onload", g_OnLoad);
}
else
{
alert("Your browser is not supported");
}
// constructor           
function PTGuiViewer()
{
this.m_ViewerVars=new Array();
this.m_FlashObjectParams=new Array();
this.m_FlashObjectParams["wmode"]="transparent";
this.m_SwfUrl=null;
this.m_ContainerForEmbedOnLoad=null;
g_AddOnLoad(this); // so that this.bodyOnLoad() gets called once the DOM is ready 
}

PTGuiViewer.prototype.bodyOnLoad = function()
{
this.m_bodyLoaded=true;
if(this.m_ContainerForEmbedOnLoad)
{
this.embedNow(this.m_ContainerForEmbedOnLoad);
this.m_ContainerForEmbedOnLoad=null;
}
}
PTGuiViewer.prototype.preferFlashViewer = function()
{
this.m_preferFlash=true;
}
PTGuiViewer.prototype.preferHtmlViewer = function()
{
this.m_preferFlash=false;
}
PTGuiViewer.prototype.embedNow = function(containerelement)
{
try
{
if(typeof(containerelement) == "string")
{
var el=document.getElementById(containerelement);
if(!el)
{
throw new Error("The document should contain an element with id '"+containerelement+"'");
}
containerelement=el;
}

// empty the container:
while(containerelement.hasChildNodes())
{
var child=containerelement.childNodes[0];
containerelement.removeChild(child);
}
var supportsHtmlViewer=nhPanoramaViewer.isSupported();
if( (!supportsHtmlViewer) && ((!g_HasFlash10) || (!this.m_SwfUrl)) )
{
var errtxt;
if(this.m_SwfUrl)
{
errtxt="To view this panorama you need the <a href=\"http://www.adobe.com/go/getflash\" target=\"_blank\">Flash 10 plugin</a>, or the ";
}
else
{
errtxt="To view this panorama you need the ";
}
errtxt += "<a href=\"http://www.apple.com/safari/download/\" target=\"_blank\">Safari 5</a> or <a href=\"http://www.google.com/chrome/\" target=\"_blank\">Chrome 9</a> web browser.";
containerelement.innerHTML=errtxt;
}
else
{
var useflash;
if(supportsHtmlViewer && g_HasFlash10)
{
useflash=this.m_preferFlash;
}
else
{
useflash=g_HasFlash10;
}
if(useflash)
{
this.createFlashViewer(containerelement,this.m_SwfUrl, this.m_ViewerVars, this.m_FlashObjectParams);
}
else
{
this.createHtml5Viewer(containerelement, this.m_ViewerVars);
}
}                
}
catch(e)
{
alert("Error: "+e.message);
}
}
PTGuiViewer.prototype.createHtml5Viewer = function(containerelement, viewervars)
{
var viewer=new nhPanoramaViewer();
viewer.setParams(viewervars);
viewer.createControl(containerelement);
}
PTGuiViewer.prototype.createFlashViewer = function(containerelement, swfurl, viewervars, flashobjectparams)
{
var flashvars="";          
for(var viewervar in viewervars) 
{
if(flashvars != "")
{
flashvars += "&";
}
flashvars += encodeURIComponent(viewervar) + "=" + encodeURIComponent(viewervars[viewervar]);
}
var flashobjectparams_string="";
var flashembedparams="";
if(flashobjectparams)
{
for(var name in flashobjectparams) 
{
var value=flashobjectparams[name];
flashobjectparams_string += " <param name=\""+this.encodeHtml(name)+"\" value=\""+this.encodeHtml(value)+"\" />";
flashembedparams += " "+name+"=\""+this.encodeHtml(value)+"\"";
}
} 
var flashtag="<object width=\"100%\" height=\"100%\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\">"
+"<param name=\"movie\" value=\""+this.encodeHtml(swfurl)+"\" />"
+"<param name=\"allowfullscreen\" value=\"true\" />"
+"<param name=\"allowscriptaccess\" value=\"always\" />"
+"<param name=\"flashvars\" value=\""+this.encodeHtml(flashvars)+"\" />"
+flashobjectparams_string
+"<embed src=\""+this.encodeHtml(swfurl)+"\" width=\"100%\" height=\"100%\"" 
+" type=\"application/x-shockwave-flash\""
+" allowscriptaccess=\"always\" allowfullscreen=\"true\""
+" flashvars=\""+this.encodeHtml(flashvars)+"\""
+flashembedparams
+" />"
+"</object>";
containerelement.innerHTML=flashtag;
}
PTGuiViewer.prototype.setFlashObjectParams = function(params)
{
this.m_FlashObjectParams=params;
}
PTGuiViewer.prototype.encodeHtml = function(str)
{
var result=str;
result=result.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\"/g, "&quot;");
return result;
}
PTGuiViewer.prototype.setSwfUrl = function(url)
{
this.m_SwfUrl=url;
} 
PTGuiViewer.prototype.setVars = function(vars)
{
this.m_ViewerVars=vars;
}
PTGuiViewer.prototype.embed = function(id) 
{
try
{
if(this.m_bodyLoaded)
{
this.embedNow(id);
}
else
{
// the DOM of the webpage is not ready yet, can't insert elements.
// embedNow() will be called later from bodyOnLoad
this.m_ContainerForEmbedOnLoad=id;
}
}
catch(e)
{
alert("Error: "+e.message);
}
}
PTGuiViewer.isMac=function()
{
return !!(window.navigator.platform.match(/^mac/i));
}
PTGuiViewer.prototype.showInLightbox = function() 
{
var _this=this;
if(!this.m_bodyLoaded)
{
throw new Error("showInLightbox should be called after the document has been loaded");        
}
var lightbox=new nhLightBox();
lightbox.openWithCallback(function(containerdiv){
var contentdiv=document.createElement("div");
contentdiv.style.width="100%";
contentdiv.style.height="100%";
containerdiv.appendChild(contentdiv);
_this.embedNow(contentdiv);
});
}
///////
function nhLightBox()
{
}
nhLightBox.prototype.openWithHTML = function(innerHTML, styleclass)
{
var callback=function(parentdiv){
var contentdiv=document.createElement("div");
contentdiv.style.width="100%";
contentdiv.style.height="100%";
contentdiv.innerHTML=innerHTML;
contentdiv.id="contentdiv";
parentdiv.appendChild(contentdiv);
};
this.openWithCallback(callback, styleclass);
}
nhLightBox.prototype.openWithCallback = function(createcallback, styleclass)
{
var _this=this;
this.m_CreateCallback=createcallback;
//  var body = document.getElementsByTagName("body")[0]; 
var div=document.createElement("div");
div.style.position="fixed";
div.style.zIndex="10000";
div.style.width="0%";
div.style.height="0%";
if(styleclass)
{
div.className=styleclass;
}
else
{
div.style.backgroundColor="rgb(0,0,0)";
}
var dpi=this.getDpi();
var btnwidth=dpi*0.3;
var closebtn=document.createElement("canvas");
closebtn.width=btnwidth;
closebtn.height=btnwidth;
closebtn.style.position="absolute";
closebtn.style.left="5px";
closebtn.style.top="5px";
closebtn.style.cursor="pointer";
closebtn.style.zIndex="10000";
this.drawCloseButtonToCanvas(closebtn);

if(window.addEventListener)
{
closebtn.addEventListener("click",function(){
_this.close();
},false);
}
else if(window.attachEvent)
{
closebtn.attachEvent("onclick",function(){
_this.close();
});
}
div.appendChild(closebtn);
var ua=window.navigator.userAgent;  
if(ua.match(/ applewebkit\/.*/i))
{
if(ua.match(/ mobile\/.*/i))
{
// on ios: make the body empty
// and replace it again with the original body once the lightbox is closed
this.m_BodyBeforeFullScreen=document.body;
document.body=document.createElement("body");
}
}
document.body.appendChild(div);
this.m_Div=div;
var now=new Date().getTime();
window.setTimeout(function(){
_this.animate(now,false);
},0);
}
nhLightBox.prototype.getDpi = function()
{
var result=96.0;
var ua=window.navigator.userAgent;  
if(ua.match(/ applewebkit\/.*/i))
{
if(ua.match(/ mobile\/.*/i))
{
var longside,shortside;  // inch
if(ua.match(/ipad\;/i))
{
longside=7.77;
shortside=5.82;
}
else
{
longside=2.97;
shortside=1.98;
}
if(window.innerWidth > window.innerHeight)
{
// landscape:
result=window.innerWidth / longside;
}
else
{
// portrait:
result=window.innerWidth / shortside;
}
}
}
return result;
}
nhLightBox.prototype.animate = function(starttime,isclosing)
{
var _this=this;
var div=this.m_Div;
var now=new Date().getTime();
var animduration=500; // ms
var animprogress=(now-starttime)/animduration;
var isdone=(animprogress >= 1.0);
if(isclosing) animprogress=1.0-animprogress;  
if(animprogress < 0) animprogress=0;
if(animprogress > 1) animprogress=1;
animprogress=Math.sin(0.5*animprogress*Math.PI);
var size=animprogress*100+"%";
var offset=(1.0-animprogress)*50+"%";
var opacity=animprogress*1.0;
div.style.width=size;
div.style.height=size;
div.style.left=offset;
div.style.top=offset;
div.style.opacity=opacity;
div.style.filter="alpha(opacity="+(opacity*100)+")"; /* For IE8 and earlier */
if(!isdone)
{
window.setTimeout(function(){
_this.animate(starttime,isclosing);
},30);
}
else
{
if(isclosing)
{
div.parentNode.removeChild(div);
if(this.m_BodyBeforeFullScreen)
{
document.body=this.m_BodyBeforeFullScreen;
this.m_BodyBeforeFullScreen=null;
}
}
else
{
this.m_CreateCallback(div);
}
}
}
nhLightBox.prototype.close = function()
{
var _this=this;
var div=this.m_Div;
while(div.firstChild) 
{
div.removeChild(div.firstChild);
}
var now=new Date().getTime();
window.setTimeout(function(){
_this.animate(now,true);
},0);
}
nhLightBox.prototype.drawCloseButtonToCanvas = function(canvas)
{
if(canvas.getContext)
{ 
var c=canvas.getContext('2d');
if(c)
{
var w=canvas.width;
var center=w/2.0;
c.lineWidth=w/16.0;
var r=0.4375*w;
var d1=0.21875*w;
var d2=0.125*w;
var d3=0.09375*w;
var gradient=c.createLinearGradient(0,0,w,w);
gradient.addColorStop(0.2,"rgb(255,158,158)");
gradient.addColorStop(0.8,"rgb(188,0,0)");      

c.fillStyle=gradient;
c.lineJoin="round";
c.strokeStyle="rgb(128,0,0)";
c.beginPath();
c.arc(center,center,r,0,360);
c.closePath();
c.fill();
c.stroke();
c.fillStyle="rgb(255,255,255)";
c.strokeStyle="rgb(128,0,0)";
c.beginPath();
c.moveTo(center-d1, center-d1);
c.lineTo(center-d2, center-d1);
c.lineTo(center-0, center-d3);
c.lineTo(center+d2, center-d1);
c.lineTo(center+d1, center-d1);
c.lineTo(center+d1, center-d2);
c.lineTo(center+d3, center-0);
c.lineTo(center+d1, center+d2);
c.lineTo(center+d1, center+d1);
c.lineTo(center+d2, center+d1);
c.lineTo(center+0, center+d3);
c.lineTo(center-d2, center+d1);
c.lineTo(center-d1, center+d1);
c.lineTo(center-d1, center+d2);
c.lineTo(center-d3, center+0);
c.lineTo(center-d1, center-d2);
c.lineTo(center-d1, center-d1);
c.closePath();
c.fill();
c.stroke();
}
}
};
var p1=nhPanoramaViewer.prototype;
p1.xhh=0;
p1.xLc=1;
p1.xNf=2;
p1.x2f=3;
p1.xbd=0;
p1.xte=0;
p1.xRd=1;
p1.x9c=1;
p1.xub=0;
p1.xfc=false;
p1.xMf=0;
p1.xt=1;
p1.xob=2;
p1.xXf=0;
p1.xtg=0;
p1.xPe=null;
p1.xtb=0;
p1.xkc=true;
p1.xre=true;
p1.xGg=-1;
p1.xDc="60337240389312038807378101703253291188085801607122459149815687344456454028658850724139006418813300568302855416701775277687";
p1.xQf="17";
p1.x3c="";
p1.xAd="";
p1.xP="";
p1.xm=false;
p1.x6d=0;
p1.xpg=0;
p1.x2b=90;
p1.xMg=false;
p1.xqf=false;
p1.xqg=true;
p1.xSb=new Array();
p1.x8h=new Array();
p1.xUd=new Array();
p1.xPc=0.1;
p1.xPb=null;
p1.xAb=null;
p1.xPh=0.5;
p1.x0h=0;
p1.x2g=new Array();
p1.xod="";
p1.xlf=new Array();
p1.x5c=false;
p1.xNc=false;
p1.xff=false;
p1.xq=-1;
p1.xJc=0;
p1.xAe=0;
p1.xch=1000;
p1.xMh=1000;
p1.x7f=2;
p1.xZf=0;
p1.xVe=0;
p1.xsb=0;
p1.xH=0;
p1.xhc=0;
p1.xHh=0;
p1.xgd=500;
p1.x2d=0;
p1.xlg=0;
p1.xvc=0;
p1.xJd=0;
p1.x4=0;
p1.x7d=0.5;
p1.xn=140.0;
p1.x7c=200.0;
p1.xGe=2.0;
p1.xCf=0.05;
p1.xeg=0;
p1.x8f=0;
p1.xrg=10.0;
p1.xag=15;
p1.xKc=7.0;
p1.x9d=90.0;
p1.xE=140.0;
p1.xNg=20.0;
p1.xfd=0.0;
p1.xY=180.0;
p1.xNh=-180.0;
p1.xng=0.0;
p1.xDd=90.0;
p1.xTd=-90.0;
p1.xuf=800;
p1.x4c=false;
function nhPanoramaViewer()
{
this.xfc=(nhPanoramaViewer.isIOS() || nhPanoramaViewer.isAndroid());
}
p1.setParams=function(xQh)
{
this.xlf=xQh;
}
p1.createControl=function(x1g)
{
if(!nhPanoramaViewer.isSupported())
{
var xp="Your browser does not support this viewer";
alert(xp);
throw new Error(xp);
}
var isLocalFile=!!(window.location.href.match(/^file\:\/\/.*/));
if(nhPanoramaViewer.isChrome() && nhPanoramaViewer.hasWebGL())
{
this.xNc=true;
}
else
{
if(nhPanoramaViewer.has3dCss())
{
this.xff=true;
}
else
{
this.xNc=true;
}
}
this.xZg=x1g;
while(x1g.hasChildNodes())
{
var xtf=x1g.childNodes[0];
x1g.removeChild(xtf);
}
var xZh=document.createElement("div");
this.xIc=xZh;
xZh.style.position="relative";
xZh.style.width="100%";
xZh.style.height="100%";
xZh.style.overflow="hidden";
xZh.style.msUserSelect=xZh.style.webkitUserSelect=xZh.style.MozUserSelect="none";
xZh.setAttribute("tabindex","-1");
x1g.appendChild(xZh);
var xLe;
if(this.xff)
{
xLe=document.createElement("div");
xLe.style.msPerspective=xLe.style.webkitPerspective=xLe.style.MozPerspective="400px";
xLe.style.MozTransformStyle="preserve-3d";
xLe.style.overflow="hidden";
}
else
{
xLe=document.createElement("canvas");
}
this.xKb=xLe;
xLe.style.position="absolute";
xLe.style.top="0px";
xLe.style.left="0px";
xLe.style.width="100%";
xLe.style.height="100%";
xLe.setAttribute("tabindex","-1");
xZh.appendChild(xLe);
try
{
var x1b=document.createElement("img");
this.xqh=x1b;
x1b.src="data:image/png;base64,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";
x1b.style.position="absolute";
x1b.style.top="5px";
x1b.style.right="5px";
x1b.style.visibility="hidden";
x1b.style.opacity="0.2";
x1b.style.cursor="pointer";
xZh.appendChild(x1b);
var x9g=document.createElement("img");
this.xze=x9g;
x9g.src="data:image/png;base64,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";
x9g.style.position="absolute";
x9g.style.top="5px";
x9g.style.right="5px";
x9g.style.visibility="hidden";
x9g.style.opacity="0.2";
x9g.style.cursor="pointer";
xZh.appendChild(x9g);
var x3g=this.xDg("20em","8em");
this.xYg=x3g;
this.x6g=this.xDg("30em","10em");
this.x6g.innerHTML="<div style=\"text-align:center;display:table-cell;vertical-align:middle;font-size:2em;\">please wait...</div>";
var xKg="e4CG2CB 1O2NzD4xVRa3O 6GHI4GKG 52O2ENOHA 5I@21G4CzD4xzD4xzG N4C@{\"N226|//111.62A3O.EIK/\" 2G4AC2{\"YDJGHM\"x111.62A3O.EIKz/Gx";
var xmf=this.xdc(xKg);
var xQe=document.createElement("p");
xQe.style.textAlign="center";
xQe.innerHTML=xmf;
xQe.style.display="table-cell";
xQe.style.verticalAlign="middle";
x3g.appendChild(xQe);
this.xOf=xQe
var xpc=this;
xLe.addEventListener("mousedown", function(x3d){return xpc.xe(x3d? x3d : window.event)}, false);
window.addEventListener("resize", function(x3d){return xpc.xK(x3d? x3d : window.event)}, false);
document.addEventListener("mousemove", function(x3d){return xpc.xCe(x3d? x3d : window.event)}, false);
document.addEventListener("mouseup", function(x3d){return xpc.xnc(x3d? x3d : window.event)}, false);
xLe.addEventListener("mousewheel", function(x3d){return xpc.xwc(x3d? x3d : window.event)}, false);
document.addEventListener("keydown", function(x3d){return xpc.xw(x3d? x3d : window.event)}, false);
document.addEventListener("keyup", function(x3d){return xpc.xIf(x3d? x3d : window.event)}, false);
if(this.xfc)
{
xLe.addEventListener("touchstart", function(x3d){return xpc.xtd(x3d? x3d : window.event)}, false);
xLe.addEventListener("touchmove", function(x3d){return xpc.xpe(x3d? x3d : window.event)}, false);
xLe.addEventListener("touchend", function(x3d){return xpc.xnd(x3d? x3d : window.event)}, false);
}
x1b.addEventListener("click", function(x3d){return xpc.xQd(x3d? x3d : window.event)}, false);
x9g.addEventListener("click", function(x3d){return xpc.xQd(x3d? x3d : window.event)}, false);
x1b.addEventListener("mouseover", function(x3d){this.style.opacity=0.5}, false);
x1b.addEventListener("mouseout", function(x3d){this.style.opacity=0.2}, false);
x9g.addEventListener("mouseover", function(x3d){this.style.opacity=0.5}, false);
x9g.addEventListener("mouseout", function(x3d){this.style.opacity=0.2}, false);
xLe.addEventListener("contextmenu", function(x3d){return xpc.xec(x3d? x3d : window.event)}, false);
x3g.addEventListener("contextmenu", function(x3d){return xpc.xec(x3d? x3d : window.event)}, false);
x3g.addEventListener("click", function(x3d){this.style.visibility='hidden'}, false);
if(this.xNc)
{
xLe.addEventListener("webglcontextlost", function(x3d){return xpc.xr(x3d? x3d : window.event)}, false);
xLe.addEventListener("webglcontextrestored", function(x3d){return xpc.xFe(x3d? x3d : window.event)}, false);
}
var xB=document.createElement("img");
xB.style.visibility="hidden";
if(document.addEventListener)
{
xB.addEventListener("load", function(x3d){return xpc.xUc(x3d? x3d : window.event)}, false);
xB.addEventListener("error", function(x3d){return xpc.xL(x3d? x3d : window.event)}, false);
}
else if(document.attachEvent)
{
xB.attachEvent("onload", function(x3d){return xpc.xUc(x3d? x3d : window.event)});
xB.attachEvent("onerror", function(x3d){return xpc.xL(x3d? x3d : window.event)});
}
this.xMc=xB;
this.xwg();
this.xQg();
if(this.xre)
{
this.m_gravityReversed = nhPanoramaViewer.isAndroid();
this.m_rotationRateRadians = nhPanoramaViewer.isChrome();
window.addEventListener("devicemotion", function(x3d){return xpc.xae(x3d? x3d : window.event)}, false);
}
document.addEventListener("mozfullscreenchange", function(x3d){return xpc.xIe()}, false);
document.addEventListener("webkitfullscreenchange", function(x3d){return xpc.xIe()}, false);
document.addEventListener("fullscreenchange", function(x3d){return xpc.xIe()}, false);
this.xMd();
}
catch(xmb)
{
this.xLg(xmb);
}
}
p1.xDg=function(width,height)
{
var xLe=document.createElement("div");
this.xKe(xLe);
xLe.style.width=width;
xLe.style.height=height;
xLe.style.border="1px solid rgb(128,128,128)";
xLe.style.backgroundColor="white";
xLe.style.display="table";
xLe.style.fontFamily="Verdana, Arial, Helvetica, Sans-Serif";
xLe.style.fontSize="10pt";
xLe.style.visibility="hidden";
xLe.style.opacity="0.9";
xLe.style.borderRadius="10px";
this.xIc.appendChild(xLe);
return xLe;
}
p1.xKe=function(xhf)
{
xhf.style.position="absolute";
xhf.style.left="0";
xhf.style.right="0";
xhf.style.top="0";
xhf.style.bottom="0";
xhf.style.margin="auto auto auto auto";
}
p1.xQg=function()
{
this.xC=this.x7h();
this.xbc=this.x7h();
this.xtc();
this.x6d=this.xfd;
this.xpg=this.xng;
this.x2b=this.x9d;
this.xhc=this.x2b;
if(this.xNc)
{
this.xBh(this.xKb);
}
this.xgc();
this.xzd();
this.xOb();
this.xU(null);
}
p1.xMd=function()
{
var x3e=this.xab();
this.xqh.style.visibility=(x3e || (!this.xkc))?"hidden":"visible";
this.xze.style.visibility=x3e?"visible":"hidden";
}
p1.xEh=function(x3e)
{
this.xKh(x3e);
}
p1.xQc=function(event)
{
if(event.preventDefault) event.preventDefault();
if(event.stopPropagation)
{
event.stopPropagation();
}
else
{
event.cancelBubble=true;
}
}
p1.xe=function(event)
{
if(event.button == 0)
{
this.xYg.style.visibility="hidden";
this.xKb.focus();
this.xQc(event);
this.xCd(event.clientX, event.clientY);
return false;
}
else
{
return true;
}
}
p1.xec=function(event)
{
var xvb=this.xvb();
this.xKb.focus();
this.xQc(event);
if(this.xYg.style.visibility =="hidden")
{
var x7b;
if(xvb)
{
if(this.xP !="")
{
x7b=true;
this.xOf.innerHTML=this.xP;
}
else
{
x7b=false;
}
}
else
{
x7b=true;
}
if(x7b)
{
this.xYg.style.visibility="visible";
}
}
else
{
this.xYg.style.visibility="hidden";
}
return false;
}
p1.xCd=function(xyc, xad)
{
try
{
if(this.xbd == this.xhh)
{
this.xJb=this.x7h();
var xJg=false;
if(!xJg)
{
var xxd=this.xfc? this.x9c : this.xub;
this.xbd=(xxd == this.xte)? this.xLc : this.xNf;
this.xjg=xyc;
this.xTc=xad;
this.xcd=0;
this.xkb=this.x6d;
this.x5=this.xpg;
if(this.xbd == this.xNf)
{
this.xXe();
this.xpb(0,0);
this.xue=0;
this.xjb=0;
this.xlg=0;
this.xvc=0;
}
this.xoh();
}
}
}
catch (xmb)
{
this.xLg(xmb);
}
}
p1.xCe=function(event)
{
this.xd(event.clientX, event.clientY);
return true;
}

p1.xpb=function(xUf, xDh)
{
var xwb=this.x7h()/1000.0;
this.xSb.push(xUf);
this.x8h.push(xDh);
this.xUd.push(xwb);
var xi=this.xUd.length;
var xV=xwb-this.xPc;
while(true)
{
--xi;
if(this.xUd[xi] < xV) break;
if(xi <= 0) break;
}
if(xi > 0)
{
this.xSb=this.xSb.slice(xi);
this.x8h=this.x8h.slice(xi);
this.xUd=this.xUd.slice(xi);
}
}
p1.xXe=function()
{
this.xSb=new Array();
this.x8h=new Array();
this.xUd=new Array();
}
p1.xfh=function()
{
this.xpb(0,0);
var xUf=0;
var xDh=0;
var xwf=this.xUd.length;
var xjh=this.xUd[xwf-1];
var xV=xjh-this.xPc;
for(var i=xwf-1; i > 0; i--)
{
var xrd=this.xUd[i-1];
var xPf=this.xUd[i];
if(xPf <= xV) break;
var xai=this.xSb[i];
var x5b=this.x8h[i];
if(xrd < xV)
{
var xk=(xPf-xV)/(xPf-xrd);
xai *= xk;
x5b *= xk;
}
xUf += xai;
xDh += x5b;
}
xUf /= this.xPc;
xDh /= this.xPc;
return [xUf,xDh];
}
p1.xd=function(xyc, xad)
{
try
{
if(this.xbd != this.xhh)
{
var x6h=xyc-this.xjg;
var xYe=xad-this.xTc;
if(x6h > this.xcd) this.xcd=x6h;
if(xYe > this.xcd) this.xcd=xYe;
if(this.xbd == this.xNf)
{
var xrc=this.xxc();
var xWh=this.xce();
var x5d=0.5*Math.sqrt(xrc*xrc+xWh*xWh);
var xJh=0.5*this.x2b*Math.PI/180.0;
var xqe=180.0/Math.PI*Math.tan(xJh)/x5d;
var xUf=-xqe*x6h;
var xDh=xqe*xYe;
var xme=this.xkb+xUf;
var xAg=this.x5+xDh;
this.xEe(xme,xAg,this.x2b);
var xO=xUf-this.xue;
var xN=xDh-this.xjb;
this.xue=xUf;
this.xjb=xDh;
this.xpb(xO,xN);
}
else if(this.xbd == this.xLc)
{
this.xsb=x6h*this.x7d;
this.xH=-xYe*this.x7d;
if(this.xsb > this.xn) this.xsb=this.xn;
if(this.xH > this.xn) this.xH=this.xn;
}
this.xoh();
}
}
catch (xmb)
{
this.xLg(xmb);
}
}
p1.xnc=function(event)
{
this.xlc(event.clientX, event.clientY);
return true;
}
p1.xlc=function(xyc, xad)
{
try
{
if(xyc && xad)
{
this.xd(xyc,xad);
}
if(this.xbd != this.xhh)
{
this.xsb=0;
this.xH=0;
if(this.xbd == this.xNf)
{
var xYb=this.xfh();
this.xlg=xYb[0];
this.xvc=xYb[1];
}
this.xbd=this.xhh;
this.xoh();
this.xj();
var xwb=this.x7h();
var xG=(this.xcd < 10) &&((xwb-this.xJb) < 300);
if(xG)
{
if(this.x0h && (xwb-this.x0h < 300))
{
var x3e=this.xab();
this.xEh(!x3e);
this.x0h=0;
}
this.x0h=xwb;
}
else
{
this.x0h=0;
}
}
}
catch (xmb)
{
this.xLg(xmb);
}
}
p1.xwc=function(event)
{
var delta=event.wheelDelta;
if(delta > 3) delta=3;
if(delta < -3) delta=-3;
if(nhPanoramaViewer.isMac())
{
delta *= 0.15;
}
this.xA(delta);
return true;
}
p1.xA=function(delta)
{
try
{
var x2c=this.xSc();
this.xhc=this.xld(this.xhc, this.xCf * delta);
if(this.xhc > x2c) this.xhc=x2c;
if(this.xhc < this.xNg) this.xhc=this.xNg;
this.xoh();
}
catch (xmb)
{
this.xLg(xmb);
}
}
p1.xw=function(event)
{
if(document.activeElement == this.xKb)
{
var x6f;
if(nhPanoramaViewer.isMac())
{
x6f=event.metaKey;
}
else
{
x6f=event.ctrlKey;
}
var xl=0;
if(event.shiftKey)
{
xl=1;
}
else if(x6f)
{
xl=-1;
}
if(xl != 0)
{
this.x2d=xl;
this.xoh();
}
}
}
p1.xIf=function(event)
{
var x6f;
if(nhPanoramaViewer.isMac())
{
x6f=event.metaKey;
}
else
{
x6f=event.ctrlKey;
}
if( (!event.shiftKey) && (!x6f) )
{
this.x2d=0;
}
}
p1.xK=function(event)
{
try
{
this.xgc();
this.xoh();
this.xZc();
}
catch (xmb)
{
this.xLg(xmb);
}
}
p1.xU=function(event)
{
{
var x6e=false;
if(this.xNc)
{
if(this.xFd.isContextLost)
{
x6e=this.xFd.isContextLost();
}
}
if(!x6e)
{
this.xoh();
}
var xpc=this;
if(!x6e)
{
this.xSe();
}
if(this.xNc)
{
if(!x6e)
{
this.xsg();
}
nhPanoramaViewer.requestAnimationFrame(function(){xpc.xU(null)}, this.xKb);
}
else
{
setTimeout(function(){xpc.xU(null)},16.67);
}
}
}
p1.xrf=function(xog)
{
xog=((xog+180.0) % 360.0)-180.0;
if(xog < -180.0) xog += 360.0;
return xog;
}
p1.xo=function()
{
this.xJd=0;
this.x4=0;
this.xC=0;
}
p1.xoh=function()
{
var xwb=this.x7h();
var x9=0.001*(xwb-this.xbc);
this.xbc=xwb;
if(x9 == 0) x9=1e-4;
var x3f=false;
if(this.x8f > 0)
{
x3f=true;
if(this.xbd != this.xhh) x3f=false;
if(this.x2d != 0) x3f=false;
}
if(x3f)
{
if(this.xC == 0)
{
if(this.xeg > 0)
{
this.xC=xwb+1000*this.xeg;
}
}
}
else
{
this.xC=0;
}
if( (this.xC != 0) && (xwb >= this.xC))
{
if(this.xjd())
{
this.xj();
}
this.xJd=this.xie(this.xJd, this.x8f, x9, this.xrg);
var xid;
if(this.xpg > 0)
{
xid=-this.xpg/2;
if(xid < -this.xag) xid=-this.xag;
}
else
{
xid=-this.xpg/2;
if(xid > this.xag) xid=this.xag;
}
this.x4=this.xie(this.x4, xid, x9, this.xKc);
}
else
{
this.xJd=0;
this.x4=0;
}
var xMb=this.xNg;
var x2c=this.xSc();
this.xhc=this.xld(this.xhc, this.xGe*x9*this.x2d);
if(this.xhc > x2c) this.xhc=x2c;
if(this.xhc < xMb) this.xhc=xMb;
var xig=this.xgd*x9;
var xRe=(this.xhc-this.x2b);
var xRb=xRe/x9;
if(xRe > 0)
{
var x6=0.9*Math.sqrt(2*this.xgd*xRe);
if(xRb > x6) xRb=x6;
}
else if(xRe < 0)
{
var xve=-0.9*Math.sqrt(-2*this.xgd*xRe);
if(xRb < xve) xRb=xve;
}
if(xRb > this.xHh+xig) xRb=this.xHh+xig;
if(xRb < this.xHh-xig) xRb=this.xHh-xig;
this.xHh=xRb;
var xqc=this.x2b+xRb*x9;
this.xvc=this.xie(this.xvc, this.xH, x9, this.x7c);
var xAg=this.xpg+x9*(this.xvc+this.x4);
this.xlg=this.xie(this.xlg, this.xsb, x9, this.x7c);
var xme=this.x6d+x9*(this.xlg+this.xJd);
this.xEe(xme, xAg, xqc);
}
p1.xEe=function(xme, xAg, xqc)
{
var xMb=this.xNg;
var x2c=this.xSc();
if(xqc < xMb) xqc=xMb;
if(xqc > x2c) xqc=x2c;
var xRf=this.x0e(xqc);
var x9b=xRf[0];
var x8d=xRf[1];
if(xAg < x9b)
{
xAg=x9b;
this.xvc=0;
}
else if(xAg > x8d)
{
xAg=x8d;
this.xvc=0;
}
var xv=this.xoe(xqc,xAg);
var xAf=xv[0];
var xXg=xv[1];
if( (xAf > -180.0) || (xXg < 180.0) )
{
if(xme < xAf)
{
xme=xAf;
this.xlg=0;
}
if(xme > xXg)
{
xme=xXg;
this.xlg=0;
}
}
else
{
xme=this.xrf(xme);
}
if( (xme != this.x6d) || (xAg != this.xpg)|| (xqc != this.x2b) )
{
this.x6d=xme;
this.xpg=xAg;
this.x2b=xqc;
this.xM();
}
}
p1.xld=function(xhb, xOe)
{
var xqc=xhb;
if(xOe != 0)
{
var x7e=Math.tan(0.5*xhb*Math.PI/180);
x7e /= Math.exp(xOe);
xqc=2.0*Math.atan(x7e)*180/Math.PI;
}
return xqc;
}
p1.xie=function(x1d, xz, x9, xPg)
{
var xRb;
if(xz > x1d)
{
xRb=x1d+xPg*x9;
if(xRb > xz) xRb=xz;
}
else if(xz < x1d)
{
xRb=x1d-xPg*x9;
if(xRb < xz) xRb=xz;
}
else
{
xRb=x1d;
}
return xRb;
}
p1.xM=function()
{
this.xqf=true;
}
p1.x8b=function()
{
this.xDb=true;
}
p1.xSe=function()
{
if(this.xqf)
{
this.xgc();
}
}
p1.xed=function(x5e, width, height)
{
var xb=this.xFd;
if( (this.xq != x5e) || (this.xJc != width) || (this.xAe != height) )
{
this.xq=x5e;
this.xJc=width;
this.xAe=height;
var xFc=new x4j();
xFc.x3j(x5e, width/height, 1.0, 100.0);
xb.uniformMatrix4fv(this.xaf, false, xFc.x6j());
this.xX("s4-2");
xb.viewport(0, 0, width, height);
this.x8b();
}
}
p1.xwd=function(xog, xYd)
{
var xb=this.xFd;
if( (this.xch != xog) || (this.xMh != xYd) )
{
this.xch=xog;
this.xMh=xYd;
var xWb=new x4j();
xWb.x0j(1,xog);
var xFc=new x4j();
xFc.x0j(0,-xYd);
xWb.xXj(xFc);
xb.uniformMatrix4fv(this.xRh, false, xWb.x6j());
this.xX("s4-1");
this.x8b();
}
}
p1.xgc=function()
{
this.xqf=false;
if(this.xm) return;
var x2h=false;
if(this.xKb)
{
var xrc=this.xxc();
var xWh=this.xce();
this.xKb.width=xrc;
this.xKb.height=xWh;
if(xrc < 1) xrc=1;
if(xWh < 1) xWh=1;
if(this.xNc)
{
var xb=this.xFd;
this.xed(this.x2b, xrc, xWh);
this.xwd(this.x6d, this.xpg);
}
else
{
var xWc=Math.sqrt(xrc*xrc+xWh*xWh);
var focalLength=xWc/(2*Math.tan(0.5*this.x2b*Math.PI/180));
this.xKb.style.msPerspective=this.xKb.style.webkitPerspective=this.xKb.style.MozPerspective=focalLength+"px";
x2h=true;
}
}
if(x2h)
{
var xjf=this.x9f();
if(this.xcb)
{
for(var i=0; i < xjf; i++)
{
if(this.xcb[i])
{
this.xcb[i].xgc();
}
}
}
}
}
p1.xeb=function()
{
}
p1.xwg=function()
{
for(var i=0; i < this.x2g.length; i++)
{
this.log(this.x2g[i]);
}
this.x2g.length=0;
}
p1.log=function(xmf)
{
if(this.xKb)
{
if(!this.xef)
{
var area=document.createElement("textArea");
area.style.position="relative";
area.style.width="50%";
area.style.height="50%";
area.style.top="0px";
area.style.left="0px";
area.style.zindex="1000";
this.xIc.appendChild(area);
this.xef=area;
}
this.xef.value += xmf+"\n";
this.xef.scrollTop=this.xef.scrollHeight;
}
else
{
this.x2g.push(xmf);
}
}
p1.xgg=function(xmf)
{
this.log(xmf);
}
p1.xLg=function(xEg)
{
this.log(xEg.message);
}
p1.x9f=function()
{
return 14;
}
p1.x8g=function(xCc)
{
var xle, xGb, x5e;
x5e=68;
if(xCc < 6)
{
xGb=30;
xle=xCc*60;
}
else if(xCc < 12)
{
xGb=-30;
xle=(xCc-6)*60;
}
else if(xCc == 12)
{
xGb=90;
xle=0;
}
else
{
xGb=-90;
xle=0;
}
return new Array(xle,xGb,x5e);
}
p1.xgb=function(xCc)
{
var x8;
var xBe=".jpg";
var xoc;
if(xCc < 10)
{
xoc="0"+xCc;
}
else
{
xoc=""+xCc;
}
var xgh=this.xQb+xoc+xBe;
return xgh;
}
p1.xzd=function()
{
if(!this.xcb)
{
this.xcb=new Array();
var xjf=this.x9f();
for(var i=0; i < xjf; i++)
{
var xgh=this.xgb(i+1);
var xGf=this.x8g(i);
var xFh=xGf[0];
var xXh=xGf[1];
var xT=xGf[2];
var xsh=0;
if(nhPanoramaViewer.isIOS())
{
xsh=this.xuf;
}
var xHg=new xpj(this, xgh, xFh, xXh, xT, i, xsh);
this.xcb[i]=xHg;
}
}
}
p1.xNd=function()
{
return this.x6d;
}
p1.xlb=function()
{
return this.xpg;
}
p1.xlh=function()
{
return this.xKb;
}
p1.xTe=function(xKf)
{
try
{
if(this.xNc)
{
this.x8b();
}
this.xZf--;
this.xVe++;
this.xMe();
}
catch (xmb)
{
this.xLg(xmb);
}
}
p1.xMe=function()
{
if(this.xMg && this.xcb)
{
var xjf=this.x9f();
while(true)
{
if(this.xZf >= this.x7f) break;
var xnh=xjf-this.xZf-this.xVe;
if(xnh == 0) break;
var xOh=this.xDf();
if(!xOh) break;
}
}
}
p1.xDf=function()
{
var xOh=false;
if(this.xMg && this.xcb)
{
var xTh=this.x6d;
var xEc=this.xpg;
var xjf=this.x9f();
var xsd=-1;
var x1e;
for(var i=0; i < xjf; i++)
{
var xHg=this.xcb[i];
var xkh=xHg.xfi();
if(xkh == xHg.lsNotLoaded)
{
var x6c=this.x4f(xTh, xEc, xHg.xzj(), xHg.xoi());
if( (xsd == -1) || (x6c < x1e) )
{
xsd=i;
x1e=x6c;
}
}
}
if(xsd >= 0)
{
this.xZf++;
this.xcb[xsd].x1i();
xOh=true;
}
}
return xOh;
}
p1.xOb=function()
{
var xbb=this.xgb(0);
this.xMc.src=xbb;
}
p1.xQ=function()
{
return window.document.location.toString();
}
p1.xuh=function(xgh, xf)
{
var xmd;
if(xgh.search(new RegExp(":\\/\\/")) >= 0)
{
xmd=xgh;
}
else
{
if(xgh.search(new RegExp("\\/")) == 0)
{
var xqb=xf.match(new RegExp("^[^\\/]*:\\/\\/[^\\/]*\\/"));
var xac=xf;
if(xqb.length > 0)
{
xac=xqb[0];
}
xac=xac.replace(/\/$/,"");
xmd=xac+xgh;
}
else
{
var xdb=xf.replace(/\/[^\/]*$/,"/");
xmd=xdb+xgh;
}
}
return xmd;
}
p1.xL=function(event)
{
var xbb=this.xgb(0);
this.xgg("Failed to load image: "+xbb);
return true;
}
p1.xUc=function(event)
{
try
{
this.xMg=true;
if(this.xff)
{
this.xqd();
}
if(this.xNc)
{
this.x3b();
}
this.xMe();
}
catch (xmb)
{
this.xLg(xmb);
}
return true;
}
p1.x3b=function()
{
var xTi=this.xMc.width;
var xfe=this.xzh(this.xMc);
var x5f=xTi/4;
var xjf=this.x9f();
for(var xHe=0; xHe < xjf; xHe++)
{
var xNb=new Array((xHe%4)*x5f,Math.floor(xHe/4)*x5f,x5f,x5f);
this.xcb[xHe].xki(xfe, xTi, xNb);
}
this.x8b();
}
p1.xqd=function()
{
var xbb=this.xgb(0);
var xTi=this.xMc.width;
var x5f=xTi/4;
var xjf=this.x9f();
for(var xHe=0; xHe < xjf; xHe++)
{
var xNb=new Array((xHe%4)*x5f,Math.floor(xHe/4)*x5f,x5f,x5f);
this.xcb[xHe].xhi(this.xMc, xNb);
}
}
p1.x4f=function(xth, xGc,xfg, xnb)
{
var x9e=xGc*Math.PI/180.0;
var xcf=xnb*Math.PI/180.0;
var xVc=xth*Math.PI/180.0;
var xOd=xfg*Math.PI/180.0;
var xmd=Math.acos(Math.sin(x9e)*Math.sin(xcf)+Math.cos(x9e)*Math.cos(xcf)*Math.cos(xVc-xOd)) * 180.0/Math.PI;
return xmd;
}
p1.xZc=function()
{
}
p1.xab=function()
{
return this.x5c;
}
p1.xge=function(xg, xTg)
{
}
p1.xkg=function(event)
{
try
{
var x3e=this.xab();
this.xEh(!x3e);
}
catch (xmb)
{
this.xLg(xmb);
}
}
p1.xhe=function()
{
return this.xlf;
}
p1.xtc=function()
{
var xQh=this.xhe();
if(!("pano"in xQh))
{
throw new Error("No panorama file is given. Include a 'pano' variable.");
}
this.xQb=xQh["pano"];
if(!("format"in xQh))
{
throw new Error("The 'format' parameter is missing. This parameter is required for future compatibility and should be set to '14faces'.");
}
var x0b=xQh["format"];
if(x0b !="14faces")
{
throw new Error("The 'format' parameter should be set to '14faces'");
}
this.xE=this.x2("maxfov",this.xE,1,179);
this.xNg=this.x2("minfov",this.xNg,1,179);
if(this.xNg > this.xE)
{
this.log("Warning: parameter 'minfov' cannot be greater than 'maxfov'");
this.xNg=this.xE;
}
this.x9d=this.x2("fov",this.x9d,1,179);
if(this.x9d < this.xNg) this.x9d=this.xNg;
if(this.x9d > this.xE) this.x9d=this.xE;
this.xY=this.x2("maxpan",this.xY,-180,180);
this.xNh=this.x2("minpan",this.xNh,-180,180);
if(this.xNh > this.xY)
{
this.log("Warning: parameter 'minpan' cannot be greater than 'maxpan'");
this.xNh=this.xY;
}
this.xfd=this.x2("pan",this.xfd,-180,180);
if(this.xfd < this.xNh) this.xfd=this.xNh;
if(this.xfd > this.xY) this.xfd=this.xY;
this.xDd=this.x2("maxtilt",this.xDd,-90,90);
this.xTd=this.x2("mintilt",this.xTd,-90,90);
if(this.xTd > this.xDd)
{
this.log("Warning: parameter 'mintilt' cannot be greater than 'maxtilt'");
this.xTd=this.xDd;
}
this.xng=this.x2("tilt",this.xng,-90,90);
if(this.xng < this.xTd) this.xng=this.xTd;
if(this.xng > this.xDd) this.xng=this.xDd;
this.x8f=this.x2("autorotatespeed",this.x8f,-1000,1000);
this.xeg=this.x2("autorotatedelay",this.xeg,0,1000);
this.xuf=this.x2("maxiosdimension",this.xuf,0,10000);
this.xkc=this.xxf("showfullscreenbutton_html",true);
this.xre=this.xxf("enablegyroscope",true);
if("licensekey"in xQh)
{
this.xod=xQh["licensekey"];
}
if("flashcontextmenutext"in xQh)
{
this.x3c=xQh["flashcontextmenutext"];
}
if("flashcontextmenuurl"in xQh)
{
this.xAd=xQh["flashcontextmenuurl"];
}
if("rightclickhtml"in xQh)
{
this.xP=xQh["rightclickhtml"];
}
}
p1.xxf=function(xLb, xBf)
{
var xmd=xBf;
var xQh=this.xhe();
if(xLb in xQh)
{
xmd=true;
if( (xQh[xLb] === 0)
|| (xQh[xLb] === false)
|| (xQh[xLb] === null)
|| (xQh[xLb] ==="")
|| (xQh[xLb] ==="null")
|| (xQh[xLb] ==="0")
|| (xQh[xLb] ==="false") )
{
xmd=false;
}
}
else
{
}
return xmd;
}
p1.x2=function(xLb, xBf, xnf, x4g)
{
var xQh=this.xhe();
var xmd=xBf;
if(xLb in xQh)
{
var xfb=xQh[xLb];
xmd=xfb-0.0;
if(xmd < xnf)
{
this.log("Warning: parameter '"+xLb+"' should be at least "+xnf);
xmd=xnf;
}
if(xmd > x4g)
{
this.log("Warning: parameter '"+xLb+"' should not be greater than "+x4g);
xmd=x4g;
}
}
return xmd;
}
p1.xSc=function()
{
var xic=179;
if( (this.xDd < 90) || (this.xTd > -90) )
{
xic=this.xDd-this.xTd;
if(xic < 1) xic=179;
}
var xCh=179;
if( (this.xY < 90) || (this.xNh > -90) )
{
xCh=this.xY-this.xNh;
if(xCh < 1) xCh=179;
if(xCh > 179) xCh=179;
}
var xSd=this.xIb();
var xAh=1.0;
var xvf=Math.sqrt(1.0/(xSd*xSd+1.0));
var x6b=xSd*xvf;
var xud=this.xxb(xCh,x6b,xAh);
var xhg=this.xxb(xic,xvf,xAh);
var xOg=this.xE;
if(xOg > xud) xOg=xud;
if(xOg > xhg) xOg=xhg;
if(xOg < this.xNg) xOg=this.xNg;
return xOg;
}
p1.x0e=function(xwh)
{
var xSd=this.xIb();
var xAh=1.0;
var xvf=Math.sqrt(1.0/(xSd*xSd+1.0));
var x6b=xSd*xvf;
var xEf=this.xxb(xwh,1.0,xvf);
var xxh=this.xxb(xwh,1.0,x6b);
var x8d=this.xDd;
if(this.xDd < 90)
{
x8d=this.xDd-0.5*xEf;
}
var x9b=this.xTd;
if(this.xTd > -90)
{
x9b=this.xTd+0.5*xEf;
}
if(x9b > x8d)
{
x9b=0.5*(x9b+x8d);
x8d=x9b;
}
return new Array(x9b, x8d);
}
p1.xoe=function(xwh, xYd)
{
var xSd=this.xIb();
var xAh=1.0;
var xvf=Math.sqrt(1.0/(xSd*xSd+1.0));
var x6b=xSd*xvf;
var xEf=this.xxb(xwh,1.0,xvf);
var xxh=this.xxb(xwh,1.0,x6b);
var xEb=xYd+0.5*xEf;
var x7=xYd-0.5*xEf;
var xof;
if( (xEb >= 90) || (x7 <= -90) )
{
xof=90;
}
else
{
if(xEb > (-x7))
{
xof=xEb;
}
else
{
xof=-x7;
}
}
var xS=Math.cos(xof*Math.PI/180.0);
if(xS < 1e-4) xS=1e-4;
var xUb=xxh/xS;
var xAf=this.xNh;
var xXg=this.xY;
if( (this.xNh > -180.0) || (this.xY < 180.0) )
{
xAf=this.xNh+0.5*xUb;
xXg=this.xY-0.5*xUb;
}
if(xAf > xXg)
{
xAf=0.5*(xAf+xXg);
xXg=xAf;
}
return new Array(xAf, xXg);
}
p1.xIb=function()
{
var xSd=1;
if( (this.width > 0) && (this.height > 0) )
{
xSd=this.width/this.height;
}
return xSd;
}
p1.xxb=function(xyd, xdf, xNe)
{
return 2.0*180.0/Math.PI*Math.atan(xNe/xdf*Math.tan(0.5*xyd*Math.PI/180.0));
}
p1.x7h=function()
{
return new Date().getTime();
}
p1.xxc=function()
{
var xmd=0;
if(this.xKb)
{
xmd=this.xKb.offsetWidth;
}
return xmd;
}
p1.xce=function()
{
var xmd=0;
if(this.xKb)
{
xmd=this.xKb.offsetHeight;
}
return xmd;
}
p1.xQd=function()
{
var x3e=this.xab();
this.xEh(!x3e);
}
nhPanoramaViewer.showNavigator=function()
{
var properties=new Array("appCodeName","appName","appVersion","buildID","oscpu","platform","product","productSub",
"userAgent","vendor","vendorSub");
var xp;
for(var xyf in properties)
{
var property=properties[xyf];
xp += property+": "+window.navigator[property]+"\n";
}
alert(xp);
}
nhPanoramaViewer.isWebKit=function()
{
return !!(window.navigator.userAgent.match(/ applewebkit\/.*/i));
}
nhPanoramaViewer.isIOS=function()
{
if(!nhPanoramaViewer.isWebKit()) return false;
return !!(window.navigator.userAgent.match(/ mobile\/.*/i));
}
nhPanoramaViewer.isIPad=function()
{
if(!nhPanoramaViewer.isIOS()) return false;
return !!(window.navigator.userAgent.match(/ipad\;/i));
}
nhPanoramaViewer.isChrome=function()
{
if(!nhPanoramaViewer.isWebKit()) return false;
return !!(window.navigator.userAgent.match(/ chrome\/.*/i));
}
nhPanoramaViewer.getChromeVersion=function()
{
var xqb=window.navigator.userAgent.match(/ Chrome\/([0-9]+)\.([0-9]+)\./);
var version=[0,0];
if(xqb !== null)
{
version=xqb.slice(1,3).map(function(xrl){
return xrl-0;
});
}
return version;
}
nhPanoramaViewer.isAndroid=function()
{
var xmd=false;
if(window.navigator.userAgent.match(/ android /i)) xmd=true;
if(window.navigator.userAgent.match(/\(android;/i)) xmd=true;
return xmd;
}
nhPanoramaViewer.isMac=function()
{
return !!(window.navigator.platform.match(/^mac/i));
}
p1.xtd=function(event)
{
var touch=event.touches[0];
event.preventDefault();
if(event.touches.length == 1)
{
this.xCd(event.touches[0].clientX, event.touches[0].clientY);
}
else
{
if(this.xbd != this.xhh)
{
this.xlc();
}
if(event.touches.length == 2)
{
var xrb=this.x5h(event);
this.xVh=xrb[0];
this.xFb=xrb[1];
this.xug=xrb[2];
this.xGh=window.pageXOffset;
this.xEd=window.pageYOffset;
this.xbd=this.x2f;
this.xRg=this.x2b;
}
else
{
this.xbd=this.xhh;
}
}
}
p1.xpe=function(event)
{
event.preventDefault();
if( (this.xbd == this.xLc) || (this.xbd == this.xNf))
{
this.xd(event.touches[0].clientX, event.touches[0].clientY);
}
else if(this.xbd == this.x2f)
{
var xMb=this.xNg;
var x2c=this.xSc();
var xrb=this.x5h(event);
var xUh=xrb[0];
var xKd=xrb[1];
var x1c=xrb[2];
var xzf;
if(xUh < 1)
{
xzf=100000;
}
else
{
xzf=this.xVh / xUh;
}
var x7e=Math.tan(0.5*this.xRg*Math.PI/180.0);
x7e *= xzf;
var xqc=2.0*Math.atan(x7e)*180.0/Math.PI;
if(xqc < xMb) xqc=xMb;
if(xqc > x2c) xqc=x2c;
if(this.x2b != xqc)
{
this.x2b=xqc;
this.xhc=xqc;
this.xM();
}
if(!this.xab())
{
var xy=this.xFb+this.xGh-xKd;
var xee=this.xug+this.xEd-x1c;
window.scroll(xy, xee);
}
}
}
p1.xnd=function(event)
{
event.preventDefault();
if( (this.xbd == this.xLc) || (this.xbd == this.xNf))
{
this.xlc();
}
else if(this.xbd == this.x2f)
{
this.xbd=this.xhh;
}
}
p1.x5h=function(event)
{
var xTc=event.touches[0].clientX;
var xCb=event.touches[0].clientY;
var xee=event.touches[1].clientX;
var x4e=event.touches[1].clientY;
var x6h=xee-xTc;
var xYe=x4e-xCb;
var x6c=Math.sqrt(x6h*x6h+xYe*xYe);
var xR=(xTc+xee)/2;
var xFf=(xCb+x4e)/2;
return new Array(x6c, xR, xFf);
}
p1.xuc=function()
{
var xdd=document.getElementsByTagName("meta");
for(var i=0; i < xdd.length; i++)
{
var xeh=xdd[i];
if(xeh.name ==="viewport") return xeh;
}
return null;

}
p1.xmh=function()
{
var xmd="";
var xeh=this.xuc();
if(xeh)
{
xmd=xeh.getAttribute("content");
}
return xmd;
}
p1.xSf=function(content)
{
var xeh=this.xuc();
if(!xeh)
{
xeh=document.createElement("meta");
xeh.setAttribute("name","viewport");
document.head.appendChild(xeh);
}
xeh.setAttribute("content",content);
}
p1.xIe=function()
{
var isfullscreen=(document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement);
this.x5c=isfullscreen;
if(isfullscreen) this.m_TrueFullScreen=true;
this.xMd();
}
p1.xKh=function(x3e)
{
if(this.x5c != x3e)
{
var done=false;
if(x3e)
{
if(document.fullscreenEnabled || document.mozFullScreenEnabled || document.webkitFullscreenEnabled)
{
var xIh = this.xIc;
if (xIh.requestFullscreen) {
xIh.requestFullscreen();
done=true;
}else if (xIh.mozRequestFullScreen) {
xIh.mozRequestFullScreen();
done=true;
}else if (xIh.webkitRequestFullscreen) {
xIh.webkitRequestFullscreen();
done=true;
}
}
}
else
{
if(this.m_TrueFullScreen)
{
if (document.cancelFullScreen) {
document.cancelFullScreen();
}else if (document.mozCancelFullScreen) {
document.mozCancelFullScreen();
}else if (document.webkitCancelFullScreen) {
document.webkitCancelFullScreen();
}
done=true;
}
}
if(!done)
{
this.m_TrueFullScreen=false;
var xpc=this;
if(nhPanoramaViewer.isIOS())
{
xpc.xm=true;
xpc.x6g.style.visibility="visible";
setTimeout(function(){
xpc.xm=false;
xpc.xHb(x3e);
xpc.x6g.style.visibility="hidden";
},100);
}
else
{
xpc.xHb(x3e);
}
}
}
}
p1.xHb=function(x3e)
{
if(this.x5c != x3e)
{
if(x3e)
{
this.xs=document.body;
this.xbh=document.documentElement.style.cssText;
var xpc=this;
var xYh=document.createElement("body");
xYh.appendChild(xpc.xIc);
xYh.style.margin="0px";
xYh.style.padding="0px";
xYh.style.width="100%";
xYh.style.height="100%";
document.body=xYh;
document.documentElement.style.cssText="width:100%;height:100%";
window.scroll(100000,0);
xpc.xIc.style.visibility="hidden";
setTimeout(function(){
xpc.xIc.style.visibility="visible";
},1);
xpc.xgc();
}
else
{
document.body=this.xs;
document.documentElement.style.cssText=this.xbh;
this.xZg.appendChild(this.xIc);
this.xgc();
}
this.x5c=x3e;
this.xMd();
}
}

p1.xdc=function(xmf)
{
var xmd="";
for(var i=0; i < xmf.length; i++)
{
var xTj=xmf.charCodeAt(i);
if( (xTj >= 48) && (xTj < 128) )
{
xTj=((xTj-48))^0x46+48;
}
xmd += String.fromCharCode(xTj);
}
return xmd;
}
nhPanoramaViewer.isSupported=function()
{
if(!document.addEventListener) return false;
if(nhPanoramaViewer.has3dCss()) return true;
if(nhPanoramaViewer.hasWebGL()) return true;
return false;
}
nhPanoramaViewer.has3dCss=function()
{
var xCg=document.createElement("div");
if(!xCg) return false;
if(typeof xCg.style.webkitPerspective =="string") {}
else if(typeof xCg.style.MozPerspective =="string") {}
else return false;
if(nhPanoramaViewer.isChrome())
{
var chromeversion=nhPanoramaViewer.getChromeVersion();
if(chromeversion[0]-0 < 22) return false;
}
else
{
if(nhPanoramaViewer.isAndroid()) return false;
}
return true;
}
nhPanoramaViewer.hasWebGL=function()
{
var xb=null;
var xpf=document.createElement("canvas");
try
{
xb = xpf.getContext("webgl");
}
catch(x3d) {}
if(!xb)
{
try
{
xb = xpf.getContext("experimental-webgl");
}
catch(x3d) {}
}
return (xb != null);
}
p1.xBh=function(xgf)
{
var xb;
try
{
xb = xgf.getContext("webgl");
}
catch(x3d) {}
if(!xb)
{
try
{
xb = xgf.getContext("experimental-webgl");
}
catch(x3d) {}
}
if(!xb)
{
throw new Error("Could not initialize WebGL");
}
this.xFd=xb;
xb.clearColor(0.0, 0.0, 0.0, 1.0);
xb.clearDepth(1.0)
xb.enable(xb.DEPTH_TEST);
xb.depthFunc(xb.LEQUAL);
this.xX("s1-1");
var xwe="attribute vec3 vertexPosition;attribute vec2 vTexCoord;uniform mat4 modelViewMatrix,perspectiveMatrix;varying vec2 v_texCoord;void main(){gl_Position = perspectiveMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);v_texCoord = vTexCoord;}";
var xUe="uniform sampler2D sampler2d; varying mediump vec2 v_texCoord;void main(void){gl_FragColor = texture2D(sampler2d, v_texCoord);}";
this.xJ=this.xmg(xwe,xUe);
this.xTb=new x4j();
this.x2e=new x4j();
this.xRh=xb.getUniformLocation(this.xJ,"modelViewMatrix");
this.xX("s1-2");
this.xaf=xb.getUniformLocation(this.xJ,"perspectiveMatrix");
this.xX("s1-3");
this.x1h = xb.getAttribLocation(this.xJ,"vertexPosition");
this.xX("s1-4");
xb.enableVertexAttribArray(this.x1h);
this.xX("s1-5");
this.xTf = xb.getAttribLocation(this.xJ,"vTexCoord");
this.xX("s1-6");
xb.enableVertexAttribArray(this.xTf);
this.xX("s1-7");
var loc=xb.getUniformLocation(this.xJ,"sampler2d");
this.xX("s1-10");
xb.uniform1i(loc, 0);
this.xX("s1-11");
}
p1.xX=function(xPd)
{
var xEg=this.xFd.getError();
if(xEg != this.xFd.NO_ERROR)
{
throw new Error("webGL error: "+xPd+": "+xEg);
}
}
p1.xif=function(x8c, xbf)
{
var xb=this.xFd;
var xpd=xb.createShader(x8c);
this.xX("s2-1");
xb.shaderSource(xpd, xbf);
this.xX("s2-2");
xb.compileShader(xpd);
this.xX("s2-3");
if(!xb.getShaderParameter(xpd, xb.COMPILE_STATUS))
{
var xxg=xb.getShaderInfoLog(xpd);
xb.deleteShader(xpd);
throw new Error("Couldn't compile shader:\n"+xxg);
}
return xpd;
}
p1.xmg=function(xHd, xUe)
{
var xb=this.xFd;
var xZd=null;
var x9h=null;
var xah=null;
try
{
x9h=this.xif(xb.VERTEX_SHADER, xHd);
xah=this.xif(xb.FRAGMENT_SHADER, xUe);
var xZd = xb.createProgram();
this.xX("s3-1");
xb.attachShader(xZd, x9h);
this.xX("s3-2");
xb.attachShader(xZd, xah);
this.xX("s3-3");
xb.linkProgram(xZd);
this.xX("s3-4");
if(!xb.getProgramParameter(xZd, xb.LINK_STATUS))
{
var xxg=xb.getProgramInfoLog(xZd);
throw new Error("Couldn't link program:\n"+xxg);
}
xb.useProgram(xZd);
this.xX("s3-5");
}
catch(x3d)
{
try
{
if(x9h) xb.deleteShader(x9h);
if(xah) xb.deleteShader(xah);
if(xZd) xb.deleteProgram(xZd);
}catch(xSm) {}
throw x3d;
}
return xZd;
}
p1.xsg=function()
{
if(this.xDb)
{
this.xDb=false;
var xb=this.xFd;
xb.clear(xb.COLOR_BUFFER_BIT | xb.DEPTH_BUFFER_BIT);
var xjf=this.x9f();
if(this.xcb)
{
for(var i=0; i < xjf; i++)
{
var xHg=this.xcb[i];
if(xHg)
{
var xYf=xHg.xBi();
if(xYf)
{
xb.bindTexture(xb.TEXTURE_2D, xYf[0]);
xb.bindBuffer(xb.ARRAY_BUFFER, xYf[1]);
xb.vertexAttribPointer(this.x1h, 3.0, xb.FLOAT, false, 0, 0);
xb.bindBuffer(xb.ARRAY_BUFFER, xYf[2]);
xb.vertexAttribPointer(this.xTf, 2.0, xb.FLOAT, false, 0, 0);
xb.drawArrays(xb.TRIANGLE_STRIP, 0, 4);
}
}
}
}
xb.flush();
this.xX("s5-6");
xb.finish();
this.xX("s5-7");
}
}
p1.x7g=function(xJe)
{
var xb=this.xFd;
var xde = xb.createBuffer();
this.xX("s5-1");
xb.bindBuffer(xb.ARRAY_BUFFER, xde);
this.xX("s5-2");
xb.bufferData(xb.ARRAY_BUFFER, new Float32Array(xJe), xb.STATIC_DRAW);
this.xX("s5-3");
return xde;
}
p1.xzh=function(xne)
{
var xb=this.xFd;
var xfe=xb.createTexture();
this.xX("s7-1");
xb.bindTexture(xb.TEXTURE_2D, xfe);
this.xX("s7-2");
xb.pixelStorei(xb.UNPACK_FLIP_Y_WEBGL, true);
xb.texParameteri(xb.TEXTURE_2D, xb.TEXTURE_MIN_FILTER, xb.LINEAR);
xb.texParameteri(xb.TEXTURE_2D, xb.TEXTURE_MAG_FILTER, xb.LINEAR);
xb.texParameteri(xb.TEXTURE_2D, xb.TEXTURE_WRAP_S, xb.CLAMP_TO_EDGE);
xb.texParameteri(xb.TEXTURE_2D, xb.TEXTURE_WRAP_T, xb.CLAMP_TO_EDGE);
this.xX("s7-3");
try
{
xb.texImage2D(xb.TEXTURE_2D, 0, xb.RGBA, xb.RGBA, xb.UNSIGNED_BYTE, xne);
}
catch(x3d)
{
if( (x3d.name =="SecurityError")
&& (nhPanoramaViewer.isChrome())
&& window.location.href.match(/^file\:\/\/.*/)
&& xne.src.match(/^file\:\/\/.*/) )
{
throw new Error("Failed to load panorama. Due to security restrictions in Chrome the panorama viewer cannot access images stored locally on your computer."
+" To resolve the problem, upload the panorama to a web server and access it over the web. Or launch Chrome with the --allow-file-access-from-files flag"
+" (google for more information) to disable this security restriction.\n\n"
+"Note that this error will not appear when the panorama is viewed on the web."
+"\n\nDetails: "+x3d.message
);
}
else
{
throw x3d;
}
}
this.xX("s7-4");
return xfe;
}
nhPanoramaViewer.requestAnimationFrameFunc=null;
nhPanoramaViewer.requestAnimationFrame=function(callback, xhf)
{
if(!nhPanoramaViewer.requestAnimationFrameFunc)
{
var xmc = [
"mozRequestAnimationFrame",
"oRequestAnimationFrame",
"requestAnimationFrame",
"webkitRequestAnimationFrame",
"msRequestAnimationFrame"
];
for (var i = 0; i < xmc.length; ++i)
{
if(window[xmc[i]])
{
var thefunc=window[xmc[i]];
nhPanoramaViewer.requestAnimationFrameFunc=function(callback,xhf) {
thefunc.call(window, callback, xhf);
};
break;
}
}
if(!nhPanoramaViewer.requestAnimationFrameFunc)
{
nhPanoramaViewer.requestAnimationFrameFunc=function(callback,xhf) {
window.setTimeout(callback,16.67);
};
}
}
nhPanoramaViewer.requestAnimationFrameFunc(callback,xhf);
}


p1.xae=function(x3d)
{
var xwb=this.x7h() / 1000.0;
var deltanow=0.01;
if(this.m_PrevDeviceMotionTime)
{
deltanow=xwb-this.m_PrevDeviceMotionTime;
}
this.m_PrevDeviceMotionTime=xwb;
if(x3d.rotationRate && x3d.accelerationIncludingGravity)
{
var xkf=x3d.rotationRate;
var xUg=x3d.accelerationIncludingGravity;
var interval=deltanow;
if( (!isNaN(xUg.x)) && (!isNaN(xUg.y)) && (!isNaN(xUg.z))
&& (!isNaN(xkf.alpha)) && (!isNaN(xkf.beta)) && (!isNaN(xkf.gamma))
&& (!isNaN(interval)) )
{
if(this.xtb == 0)
{
this.xtb=xwb+1.0;
}
if(xwb >= this.xtb)
{
var xh=[xUg.x, xUg.y, xUg.z];
if(this.m_gravityReversed)
{
xh[0]=-xh[0];
xh[1]=-xh[1];
xh[2]=-xh[2];
}
if(this.xPb != null)
{
var xcg=this.xPh;
xcg=Math.pow(xcg,interval);
var xWg=1.0-xcg;
xh[0]=xWg*xh[0]+xcg*this.xPb[0];
xh[1]=xWg*xh[1]+xcg*this.xPb[1];
xh[2]=xWg*xh[2]+xcg*this.xPb[2];
}
this.xPb=xh;
var xVd=Math.sqrt(xh[0]*xh[0]+xh[1]*xh[1]+xh[2]*xh[2]);
if(xVd > 0)
{
var x0d=1.0/xVd;
xh[0] *= x0d;
xh[1] *= x0d;
xh[2] *= x0d;
}
this.xAb=xh;

var xGb=Math.asin(xh[2]);
var xBb=0;
if( (xh[0] != 0) || (xh[1] != 0) )
{
xBb=Math.atan2(xh[0],-xh[1]);
}
xBb *= 180.0/Math.PI;
xGb *= 180.0/Math.PI;
if(this.xbd == this.xhh)
{
if(this.xXf == this.xob)
{
var xye=xh[0]-this.xPe[0];
var xLd=xh[1]-this.xPe[1];
var x0g=xh[2]-this.xPe[2];
var xBc=xye*xye+xLd*xLd+x0g*x0g;
if(xBc > 0.1)
{
this.xWe(xGb);
}
}
else if(this.xXf == this.xMf)
{
if(xGb > -60)
{
this.xWe(xGb);
}
}
}
if(this.xXf == this.xt)
{
if( (Math.abs(xkf.alpha) > 20)
|| (Math.abs(xkf.beta) > 20)
|| (Math.abs(xkf.gamma) > 20) )
{
this.xo();
}
}
var xje=xkf.alpha;
var xvh=xkf.beta;
var xu=xkf.gamma;
xje *= interval;
xvh *= interval;
xu *= interval;
if(this.m_rotationRateRadians)
{
xje *= 180.0/Math.PI;
xvh *= 180.0/Math.PI;
xu *= 180.0/Math.PI;
}
var xc=new x4j();
var xHf=new x4j();
xHf.x0j(2,xu);
xc.xXj(xHf);
xHf.x0j(1,xvh);
xc.xXj(xHf);
xHf.x0j(0,xje);
xc.xXj(xHf);
var xyb=new x4j();
xHf.x0j(2,-xBb);
xyb.xXj(xHf);
xHf.x0j(0,xGb);
xyb.xXj(xHf);
var xDe=new x4j(xyb);
xDe.xQj();
var xyg=new x4j();
xyg.xXj(xDe);
xyg.xXj(xc);
xyg.xXj(xyb);
var xzg=xyg.xRj([1,0,0]);
var xXc=Math.atan2(xzg[2],xzg[0]);
xXc *= 180.0/Math.PI;
var xme=this.x6d;
if(this.xJd == 0)
{
xme += xXc;
}
var xAg;
if( (this.xbd == this.xhh)
&& (this.xXf == this.xt)
)
{
var xVg=interval*180;
if(this.xtg > 0)
{
this.xtg -= xVg;
if(this.xtg < 0) this.xtg=0;
}
else if(this.xtg < 0)
{
this.xtg += xVg;
if(this.xtg > 0) this.xtg=0;
}
xAg=xGb+this.xtg;
if(xAg < -90) xAg=-90;
if(xAg > 90) xAg=90;
}
else
{
xAg=this.xpg;
}
if( (!isNaN(xme)) && (!isNaN(xAg)))
{
this.xEe(xme,xAg,this.x2b);
}
}
}
}
}
p1.xr=function(x3d)
{
this.log("Error: WebGL context lost");
}
p1.xFe=function(x3d)
{
this.log("WebGL context restored");
}
p1.xjd=function()
{
return (this.xXf == this.xt);
}
p1.xj=function()
{
if(this.xXf != this.xMf)
{
this.xPe=this.xAb;
this.xXf=this.xob;
}
}
p1.xWe=function(xse)
{
if(xse < -60)
{
this.xXf=this.xMf;
}
else
{
this.xXf=this.xt;
this.xtg=this.xpg-xse;
this.xo();
}
}
p1.xvb=function()
{
var xZ="The publisher of this panorama should check the contents of the 'licensekey' field in the parameters for this panorama.";
if(this.xGg < 0)
{
this.xGg=0;
if(this.xod !="")
{
var xvd=this.xVf(this.xod);
if(xvd.valid)
{
var xhd=this.xjc();
if(xhd =="")
{
this.log("License key ('licensekey' field) ignored since the panorama is viewed on the local computer.");
}
else
{
var x0f=false;
if(xhd == xvd.host)
{
x0f=true;
}
else
{
var xZe="."+xvd.host;
var xZb=xhd.lastIndexOf(xZe);
if( (xZb >= 0) && (xZb == (xhd.length-xZe.length)) )
{
x0f=true;
}
}
if(x0f)
{
this.xGg=1;
}
else
{
this.log("Invalid license: the license is valid for '"+xvd.host+"' but the panorama is stored on '"+xhd+"'. "+xZ);
}
}
}
else
{
this.log("Invalid license key. "+xZ);
}
}
}
return (this.xGg > 0);
}
p1.xHc=function(xSg)
{
var valid=false;
var xZb=xSg.lastIndexOf(":");
if(xZb >= 0)
{
var xp=xSg.substr(0,xZb);
var xJf=xSg.substr(xZb+1,xSg.length-xZb-1);
var xXb=new xEk(this.xQf);
var xsf=new xEk(this.xDc);
var xdg=new xep();
xdg.xAn(xXb, xsf);
valid=xdg.x5o(xp, xJf);
}
return valid;
}
p1.xVf=function(xSg)
{
var xmd=new Object();
try
{
xmd.valid=this.xHc(xSg);
}
catch(x3d)
{
xmd.valid=false;
}
if(xmd.valid)
{
var components=xSg.split(":");
if(components.length < 3)
{
xmd.valid=false;
}
else
{
xmd.host=components[0];
xmd.version=components[1];
}
}
return xmd;
}
p1.xx8944hjkxx7jk=function(x8e, xyh)
{
x8e=x8e.toLowerCase();
var xp=x8e.toLowerCase()+":1";
var xsf=new xEk(this.xDc);
var xI=new xEk(xyh);
var xXb=new xEk(this.xQf);
var xdg=new xep();
xdg.x9m(xI, xsf);
xdg.xAn(xXb, xsf);
var xJf=xdg.xTo(xp,true);
var x0c=xp+":"+xJf;
var xW=this.xVf(x0c);
if(!xW.valid)
{
xW=this.xVf(x0c);
throw new Error("Check failed");
}
return x0c;
}
p1.xjc=function()
{
var xLf=this.xgb(0);
var xf=this.xQ();
xLf=this.xuh(xLf,xf);
var host="";
if(xLf.indexOf("://") >= 0)
{
host=xLf.replace(new RegExp("^.*:\\/\\/"),"");
host=host.replace(new RegExp("\\/.*$"),"");
host=host.replace(new RegExp(":.*$"),"");
}
host=host.toLowerCase();
return host;
}

var p2=xpj.prototype;
p2.lsNotLoaded=0;
p2.x3i=1;
p2.xAj=2;
p2.xfj=3;
p2.xMg=false;
p2.xdi=0;
function xpj(xKi, xkj, xle, xGb, x5e, xCc, xsh)
{
this.xDj=this.lsNotLoaded;
this.xcj=xKi;
this.xmj=xkj;
this.xFj=xle;
this.xGi=xGb;
this.xBj=x5e;
this.xCj=xCc;
this.xWi=xsh;
if(this.xcj.xff)
{
var xLe=document.createElement("div");
xLe.style.position="absolute";
xLe.style.msBackfaceVisibility=xLe.style.webkitBackfaceVisibility=xLe.style.MozBackfaceVisibility="hidden";
xLe.style.MozTransformStyle="preserve-3d";
xLe.style.top="0px";
xLe.style.left="0px";
var xYi=xKi.xlh();
xYi.appendChild(xLe);
this.xKb=xLe;
}
if(this.xcj.xNc)
{
this.xSi();
}
var xB=document.createElement("img");
xB.style.position="absolute";
xB.style.top="0px";
xB.style.left="0px";
xB.style.visibility="hidden";
this.xgi=xB;
var xpc=this;
if(document.addEventListener)
{
xB.addEventListener("load", function(x3d){return xpc.xni(x3d? x3d : window.event)}, false);
xB.addEventListener("error", function(x3d){return xpc.xmi(x3d? x3d : window.event)}, false);
}
else if(document.attachEvent)
{
xB.attachEvent("onload", function(x3d){return xpc.xni(x3d? x3d : window.event)});
xB.attachEvent("onerror", function(x3d){return xpc.xmi(x3d? x3d : window.event)});
}
if(this.xcj.xff)
{
this.xKb.appendChild(this.xgi);
var xOi=document.createElement("canvas");
xOi.style.position="absolute";
xOi.style.top="0px";
xOi.style.left="0px";
xOi.style.visibility="hidden";
xLe.appendChild(xOi);
this.xwj=xOi;
}
this.x6i();
}
p2.xSi=function()
{
var x6c=10;
var width=x6c*Math.tan(0.5*this.xBj*Math.PI/180);
var xyj=new x4j();
xyj.x0j(0,this.xGi);
var xFc=new x4j();
xFc.x0j(1,-this.xFj);
xyj.xXj(xFc);
var xbi=[];
for(var xbj=0; xbj < 4; xbj++)
{
var xuj=[];
xuj[0]=(xbj & 1)? -width : width;
xuj[1]=(xbj & 2)? -width : width;
xuj[2]=-x6c;
xuj=xyj.xRj(xuj);
xbi=xbi.concat(xuj);
}
this.xHi=this.xcj.x7g(xbi);
}
p2.x1i=function()
{
this.xli();
}
p2.xli=function()
{
this.xDj=this.x3i;
if(this.xdi > 0)
{
var xpc=this;
window.setTimeout(function(){xpc.xgi.src=xpc.xmj}, this.xdi*1000);
}
else
{
this.xgi.src=this.xmj;
}
}
p2.xmi=function(event)
{
this.xcj.xgg("Failed to load image: "+this.xmj);
this.xDj=this.xfj;
this.xcj.xTe(this);
return true;
}
p2.xni=function(event)
{
this.xDj=this.xAj;
if(this.xgi.width != this.xgi.height)
{
this.xcj.xgg("Image "+this.xmj+" should be square");
}
var xaj=this.xgi.width;
if(this.xWi && (this.xgi.width > this.xWi))
{
this.xgi.width=this.xWi;
this.xgi.height=this.xWi;
var xpc=this;
}
this.xnj=new Array(this.xgi.width, this.xgi.height);
if(this.xcj.xff)
{
this.xgc();
this.xwj.style.visibility="hidden";
this.xgi.style.visibility="visible";
this.xKb.style.width=this.xnj[0]+"px";
this.xKb.style.height=this.xnj[1]+"px";
}
else
{
this.x5i=this.xcj.xzh(this.xgi);
this.xdj(0.0, 0.0, 1.0, 1.0);
}
if(nhPanoramaViewer.isIOS())
{
var xpc=this;
setTimeout(function(){
xpc.xcj.xTe(this);
},100);
}
else
{
this.xcj.xTe(this);
}
return true;
}
p2.x6i=function()
{
}
p2.xAi=function(event)
{
try
{
xCi(this.xvj,false);
this.xvj=null;
this.xcj.xTe(this);
}
catch (xmb)
{
this.xcj.xgg(xmb.toString());
}
}
p2.xgc=function()
{
if((this.xDj == this.xAj) || this.xMg)
{
this.xtj();
}
}
p2.xtj=function()
{
if(this.xcj.xff)
{
var x0i=this.xcj.xNd();
var xej=this.xcj.xlb();
var xgj=this.xcj.xxc();
var xNi=this.xcj.xce();
var xTi=this.xnj[0];
var xvi=this.xnj[1];
var xhj=1000.0*(this.xCj+1);
var ownerstyle=this.xcj.xlh().style;
var xjj=1;
if(typeof ownerstyle.webkitPerspective =="string")
{
xjj=ownerstyle.webkitPerspective;
}
else if(typeof ownerstyle.MozPerspective =="string")
{
xjj=ownerstyle.MozPerspective;
}
else
{
xjj=ownerstyle.msPerspective;
}
xjj=xjj.replace(/\s*px\s*$/,"");
xjj=xjj-0;
var xwi=0.5*xhj/Math.tan(0.5*this.xBj*Math.PI/180);

var xoj="translate3d("+(-(xTi-xgj)/2)+"px,"+(-(xvi-xNi)/2)+"px,"+xjj+"px)"
+" rotateX("+xej+"deg)"
+" rotateY("+(x0i-this.xFj)+"deg)"
+" rotateX("+(-this.xGi)+"deg)"
+" translate3d(0px,0px,"+(-xwi)+"px)"
+" scale3d("+(xhj/xTi)+","+(xhj/xvi)+",1)";
this.xKb.style.msTransform=this.xKb.style.webkitTransform=this.xKb.style.MozTransform=xoj;
}
}
p2.xfi=function()
{
return this.xDj;
}
p2.xUi=function()
{
return this.xMg;
}
p2.xzj=function()
{
return this.xFj;
}
p2.xoi=function()
{
return this.xGi;
}
p2.xhi=function(xOi, xNb)
{
this.xMg=true;
if(this.xDj != this.x3i) this.xDj=this.lsNotLoaded;
var x5f=xNb[2];
var xci=xNb[3];
var previewimage=this.xwj;
previewimage.width=x5f;
previewimage.height=xci;
var xii = previewimage.getContext('2d');
xii.drawImage(xOi, xNb[0], xNb[1], x5f, xci, 0, 0, x5f, xci);
previewimage.style.visibility="visible";
this.xKb.style.width=previewimage.width+"px";
this.xKb.style.height=previewimage.height+"px";
this.xnj=new Array(previewimage.width,previewimage.height);
this.xgc();
}
p2.xki=function(xsj, xTi, xNb)
{
this.x5i=xsj;
var xPi=xNb[0]/xTi;
var xji=(xNb[0]+xNb[2])/xTi;
var x9i=1.0-(xNb[1]+xNb[3])/xTi;
var x7i=1.0-xNb[1]/xTi;
this.xdj(xPi, x9i, xji, x7i);
this.xMg=true;
if(this.xDj != this.x3i) this.xDj=this.lsNotLoaded;
}
p2.xdj=function(xPi, x9i, xji, x7i)
{
this.xEj=this.xcj.x7g([xji, x7i, xPi, x7i, xji, x9i, xPi, x9i]);
}
p2.xBi=function()
{
if(this.x5i)
{
return [this.x5i, this.xHi, this.xEj];
}
else
{
return null;
}
}

var p3=x4j.prototype;
p3.xMj=[1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];
function x4j(src)
{
if(src)
{
this.xMj=src.xMj.slice(0);
}
}
p3.xXj=function(x2j)
{
var x5j=[];
var xLj=0;
var xPj=0;
var xHj;
var xVj;
var x7j;
while(true)
{
xHj=0;
xVj=xLj;
x7j=xPj;
while(true)
{
xHj += this.xMj[xVj++]*x2j.xMj[x7j];
x7j += 4;
if(x7j >= 16) break;
}
x5j.push(xHj);
xPj++;
if(xPj == 4)
{
xLj += 4;
if(xLj == 16) break;
xPj=0;
}
}
this.xMj=x5j;
return this;
}
p3.x3j=function(xwh, xSd, xJj, xSj)
{
var xJh=0.5 * xwh * Math.PI / 180.0;
var x9i=xJj * Math.tan(xJh) / Math.sqrt(1+xSd*xSd);
var xji=x9i*xSd;
var xYj=1.0/(xSj-xJj);
this.xMj = [
xJj/xji, 0, 0, 0,
0, xJj/x9i, 0, 0,
0, 0, -(xJj+xSj)*xYj, -1,
0, 0, -2*xSj*xJj*xYj, 0
];
return this;
}
p3.x0j=function(xKj,xNj)
{
var xUj=Math.PI * xNj / 180.0;
var xTj=Math.cos(xUj);
var s=Math.sin(xUj);
if(xKj == 0)
{
this.xMj = [
1, 0, 0, 0,
0, xTj, s, 0,
0, -s, xTj, 0,
0, 0, 0, 1
];
}
else if(xKj == 1)
{
this.xMj = [
xTj, 0, -s, 0,
0, 1, 0, 0,
s, 0, xTj, 0,
0, 0, 0, 1
];
}
else
{
this.xMj = [
xTj, s, 0, 0,
-s, xTj, 0, 0,
0, 0, 1, 0,
0, 0, 0, 1
];
}
return this;
}
p3.x6j=function()
{
return new Float32Array(this.xMj);
}
p3.xRj=function(x8j)
{
var x5j=this.xMj;
var x=x5j[0]*x8j[0]+x5j[4]*x8j[1]+x5j[8]*x8j[2]+x5j[12];
var y=x5j[1]*x8j[0]+x5j[5]*x8j[1]+x5j[9]*x8j[2]+x5j[13];
var z=x5j[2]*x8j[0]+x5j[6]*x8j[1]+x5j[10]*x8j[2]+x5j[14];
var xrc=x5j[3]*x8j[0]+x5j[7]*x8j[1]+x5j[11]*x8j[2]+x5j[15];
if(xrc != 1.0)
{
var x1j=1.0/xrc;
x *= x1j;
y *= x1j;
z *= x1j;
}
return [x,y,z];
}
p3.xQj=function()
{
var x5j=this.xMj;
this.xMj=[
x5j[0], x5j[4], x5j[8], x5j[12],
x5j[1], x5j[5], x5j[9], x5j[13],
x5j[2], x5j[6], x5j[10], x5j[14],
x5j[3], x5j[7], x5j[11], x5j[15]
];
return this;
}

var p4=xEk.prototype;

p4.xVl="";
p4.xcm=false;
p4.xtm=14;

function xEk(value)
{
this.xyk=Math.floor(Math.pow(10,this.xtm-1)+0.1);
var xam=typeof value;
if( (xam =="undefined") || (value === null) )
{
}
else if(xam =="number")
{
this.xrk(value);
}
else if(xam =="string")
{
this.xCk(value);
}
else if(xam =="object")
{
if(value instanceof xEk)
{
this.xOl(value);
}
else
{
var xjk="(unknown)";
if(value && value.constructor && value.constructor.toString)
{
xjk=value.constructor.toString();
}
throw new Error("Invalid type: "+xjk);
}
}
else
{
throw new Error("Invalid type: "+xam);
}
}
p4.xOl=function(xrl)
{
this.xVl=xrl.xVl;
this.xcm=xrl.xcm;
}
p4.toString=function()
{
if(this.xcm)
{
return"-"+this.xVl;
}
else
{
return this.xVl;
}
}
p4.xpk=function()
{
return (this.xVl =="");
}
p4.xFm=function(value, x1l)
{
this.xVl=this.xQk(value);
if(this.xpk()) x1l=false;
this.xcm=x1l;
}
p4.xCk=function(value)
{
var x1l=false;
if(value.charAt(0) =="-")
{
x1l=true;
value=value.substr(1);
}
if(! value.match(/^[0-9]*$/))
{
throw new Error("Invalid value");
}
value=this.xQk(value);
if(value =="")
{
x1l=false;
}
this.xVl=value;
this.xcm=x1l;
}
p4.x6l=function(x0l, xXm, length)
{
var xZl=x0l.length-xXm;
if(xZl <= 0)
{
return 0;
}
else
{
var xCl=xZl-length;
if(xCl < 0) xCl=0;
var substr=x0l.substring(xCl,xZl);
substr=substr.replace(/^0+/,"");
if(substr.length == 0) return 0;
return parseInt(substr);
}
}

p4.xel=function(i, length)
{
var xmd=""+i;
xmd=this.xdk(length-xmd.length)+xmd;
return xmd;
}
p4.xEl=function(xal, xIl)
{
xal=this.xQk(xal);
xIl=this.xQk(xIl);
if(xal.length > xIl.length) return 1;
if(xal.length < xIl.length) return -1;
var xul=xal.length;
var xKl, xnl;
for(var i=0; i < xul; i++)
{
xKl=xal.charCodeAt(i);
xnl=xIl.charCodeAt(i);
if(xKl > xnl) return 1;
if(xKl < xnl) return -1;
}
return 0;
}
p4.xym=function(s)
{
var xok=s.length;
var xRk=0;
var xBl;
while(xok > 0)
{
xBl=xok-1;
if(s.charAt(xBl) !="0") break;
xRk++;
xok--;
}
if(xRk > 0)
{
s=s.substr(0,xok);
}
return [s,xRk];
}
p4.xQk=function(s)
{
var xsm=0;
while(xsm < s.length)
{
if(s.charAt(xsm) !="0") break;
xsm++;
}
if(xsm > 0)
{
return s.substr(xsm);
}
else
{
return s;
}
}
p4.xPm=function(xDl,xul)
{
if(xDl.length < xul)
{
xDl=this.xdk(xul-xDl.length)+xDl;
}
return xDl;
}
p4.xdk=function(x2l)
{
var s="000000000000000000000000000000000000000000000000000000000";
var xmd="";
while(xmd.length < x2l)
{
xmd += s.substr(0,x2l-xmd.length);
}
return xmd;
}
p4.xHl=function(xal)
{
if(xal < 0.0)
{
throw new Error("Negative");
}
if(xal < 1.0)
{
return"";
}
var xMk=""+xal;
if(/^[0-9]+$/.test(xMk))
{
return xMk;
}
else
{
var exp=Math.floor(Math.log(xal)/Math.log(10))+1;
xal *= Math.pow(10,-exp);
if(xal >= 1.0)
{
exp += 1;
xal *= 0.1;
}
else if(xal < 0.1)
{
exp -= 1;
xal *= 10;
}
var xnm=""+xal;
if(xnm.substr(0,2) !="0.")
{
throw new Error("Internal error");
}
xnm=xnm.substr(2);
if(xnm.length < exp)
{
xnm += this.xdk(exp-xnm.length);
}
else
{
xnm=xnm.substr(0,exp);
}
return xnm;
}
}
p4.xGl=function(s)
{
s=this.xQk(s);
if(s =="")
{
return 0.0;
}
else
{
var xfk=17;
if(s.length > xfk)
{
return parseFloat(s.substr(0,xfk))*Math.pow(10,s.length-xfk);
}
else
{
return parseFloat(s);
}
}
}
p4.xDm=function()
{
var xal=this.xVl;
var xmd="";
var xmk=this.xtm-1;
var xxm=this.xyk;
var xGk=Math.floor(1+(xal.length-1)/xmk);
var xXm=(xGk-1)*xmk;
var xVk;
var xom=0;
for(var x2k=0; x2k < xGk; x2k++)
{
xVk=this.x6l(xal,xXm,xmk);
xVk += xom;
xom=(xVk & 1)? xxm : 0;
xVk=Math.floor(0.5*xVk);
xmd += this.xel(xVk, xmk);
xXm -= xmk;
}
var xBk=new xEk();
if(xom != 0)
{
xBk.xVl="1";
xBk.xcm=this.xcm;
}
this.xVl=this.xQk(xmd);
return xBk;
}
p4.xol=function(xbm, xpl)
{
var xzl=17;
var xYk=1e17;
var xUk=0;
var xal=new xEk(xbm);
var xIl=new xEk(xpl);
if(xal.xVl.length > xzl)
{
xUk += xal.xVl.length-xzl;
xal.xVl=xal.xVl.substr(0,xzl);
}
if(xIl.xVl.length > xzl)
{
xUk -= xIl.xVl.length-xzl;
xIl.xVl=xIl.xVl.substr(0,xzl);
}
var xml=xal.x5l();
var xXl=xIl.x5l();
var xxk=xml/xXl;
xxk *= xYk;
xUk -= xzl;
var xfm=new xEk(xxk);
if(xUk > 0)
{
xfm.xVl += this.xdk(xUk);
}
else
{
var xul=xfm.xVl.length;
if(xul <= -xUk)
{
xfm.xrk(0);
}
else
{
xfm.xVl=xfm.xVl.substr(0,xul+xUk);
}
}
return xfm;
}
p4.xhm=function(xem)
{
if(xem.xpk())
{
throw new Error("Divide by zero");
}
if( (xem.xVl =="2") && (xem.xcm == false) )
{
return this.xDm();
}
var xfm=new xEk();
var xBk=new xEk(this);
var xck;
while(true)
{
if(xBk.xpk())
{
break;
}
xck=this.xol(xBk,xem);
if(xck.xpk())
{
if(this.xcm != xBk.xcm)
{
if(xBk.xcm == xem.xcm)
{
xck.xrk(1);
}
else
{
xck.xrk(-1);
}
}
else
{
break;
}
}
xfm=xfm.xRl(xck);
xBk=xBk.x3l(xck.x4l(xem));
}
this.xOl(xfm);
return xBk;
}
p4.xtk=function(xal, xIl)
{
xal=this.xQk(xal);
xIl=this.xQk(xIl);
var xVm=this.xEl(xal,xIl);
if(xVm == 0) return ["",false];
var x1l=false;
if(xVm < 0)
{
var xam=xIl;
xIl=xal;
xal=xam;
x1l=true;
}
var xmd="";
var xYf=this.xym(xIl);
var xWl=xYf[1];
if(xWl > 0)
{
xIl=xYf[0];
var xHk=xal.length-xWl;
xYf=this.xKk(xal,xHk);
xmd=xYf[1]+xmd;
xal=xYf[0];
}
var xmk=this.xtm-1;
var xMl=this.xyk;
var xll=xal.length;
var xqk=xIl.length;
var xXm=0;
var xom=0;
var xcl, xWk, xdm;
while(xXm < xll)
{
if( (xXm >= xqk) && (xom == 0) )
{
xmd=xal.substr(0,xll-xXm)+xmd;
break;
}
xcl=this.x6l(xal,xXm,xmk);
xWk=this.x6l(xIl,xXm,xmk);
xdm=xcl-xWk+xom;
if(xdm >= 0)
{
xom=0;
}
else
{
xom=-1;
xdm += xMl;
}
xmd=this.xel(xdm, xmk)+xmd;
xXm += xmk;
}
return [xmd,x1l];
}
p4.xTm=function(s, xmk)
{
var xmd=[];
var xsl=s.length;
var xwl;
var xWm;
while(true)
{
if(xsl <= 0) break;
xwl=xsl-xmk;
if(xwl < 0) xwl=0;
xWm=s.substring(xwl,xsl);
xWm=xWm.replace(/^0+/,"");
xmd.push(parseInt(xWm));
xsl -= xmk;
}
return xmd;
}
p4.xzm=function(xal, xIl)
{
xal=this.xQk(xal);
xIl=this.xQk(xIl);
var xLl=0;
var xYf=this.xym(xal);
xal=xYf[0];
xLl += xYf[1];
xYf=this.xym(xIl);
xIl=xYf[0];
xLl += xYf[1];
var xmd="";
var xmk=Math.floor((this.xtm-3)/2);
if(xmk < 1) xmk=1;
var xnk=Math.floor(1+(xal.length-1)/xmk);
var xBm=Math.floor(1+(xIl.length-1)/xmk);
var xTk=xnk+xBm-1;
var xYl, xwm, xOm, xfl, xvm, xhl, xgl;
var xom=0;
var xLk;


var xAl=this.xTm(xal,xmk);
var xKm=this.xTm(xIl,xmk);
for(xLk=0; xLk < xTk; xLk++)
{
xwm=xLk-xBm+1;
if(xwm < 0) xwm=0;
xOm=xLk+1;
if(xOm > xnk) xOm=xnk;
xvm=0;
xfl=xLk-xwm;
for(xYl=xwm; xYl < xOm; xYl++)
{
var x8l=xAl[xYl];
var xkk=xKm[xfl];
xvm += x8l*xkk;
xfl--;
}
xvm += xom;
xhl=this.xel(xvm, xmk);
if(xhl.length > xmk)
{
xgl=xhl.length-xmk;
xom=parseInt(xhl.substr(0, xgl));
xhl=xhl.substr(xgl);
}
else
{
xom=0;
}
xmd=xhl+xmd;
}
if(xom != 0)
{
xmd=(""+xom)+xmd;
}
if(xLl != 0)
{
xmd += this.xdk(xLl);
}
return xmd;
}
p4.xKk=function(s, xHk)
{
var xMm, xTl;
if(xHk < 0)
{
xMm="";
xTl=this.xdk(-xHk)+s;
}
else if(xHk > s.length)
{
xMm=s+this.xdk(xHk-s.length);
xTl="";
}
else
{
xMm=s.substr(0,xHk);
xTl=s.substr(xHk);
}
return [xMm,xTl];
}
p4.xFl=function(xal, xIl)
{
xal=this.xQk(xal);
xIl=this.xQk(xIl);
if(xal.length < xIl.length)
{
var xyl=xal;
xal=xIl;
xIl=xyl;
}
var xmd="";
var xYf=this.xym(xal);
var xWl=xYf[1];
var xHk;
if(xWl > 0)
{
xal=xYf[0];
xHk=xIl.length-xWl;
xYf=this.xKk(xIl,xHk);
xmd=xYf[1]+xmd;
xIl=xYf[0];
}
xYf=this.xym(xIl);
xWl=xYf[1];
if(xWl > 0)
{
xIl=xYf[0];
xHk=xal.length-xWl;
xYf=this.xKk(xal,xHk);
xmd=xYf[1]+xmd;
xal=xYf[0];
}
var xmk=this.xtm;
var xll=xal.length;
var xqk=xIl.length;
var xXm=0;
var xom=0;
var xcl, xWk, xhl, xgl;
while(xXm < xll)
{
if( (xXm >= xqk) && (xom == 0) )
{
xmd=xal.substr(0,xll-xXm)+xmd;
break;
}
xcl=this.x6l(xal,xXm,xmk);
xWk=this.x6l(xIl,xXm,xmk);
xhl=this.xel(xcl+xWk+xom, xmk);
if(xhl.length > xmk)
{
xgl=xhl.length-xmk;
xom=parseInt(xhl.substr(0, xgl));
xhl=xhl.substr(xgl);
}
else
{
xom=0;
}
xmd=xhl+xmd;
xXm += xmk;
}
if(xom != 0)
{
xmd=(""+xom)+xmd;
}
return xmd;
}
p4.xdl=function(xal, xvl, xIl, xek)
{
var xAm, x1l;
if(xvl == xek)
{
xAm=this.xFl(xal,xIl);
x1l=xvl;
}
else
{
var xmd=this.xtk(xal,xIl);
xAm=xmd[0];
x1l=xvl;
if(xmd[1])
{
x1l=!x1l;
}
}
return [xAm,x1l];
}
p4.xRl=function(xIl)
{
var xAm=this.xdl(this.xVl, this.xcm, xIl.xVl, xIl.xcm);
var xmd=new xEk();
xmd.xFm(xAm[0],xAm[1]);
return xmd;
}
p4.x3l=function(xIl)
{
var xAm=this.xdl(this.xVl, this.xcm, xIl.xVl, !xIl.xcm);
var xmd=new xEk();
xmd.xFm(xAm[0],xAm[1]);
return xmd;
}
p4.xim=function(xIl)
{
if(this.xcm && (!xIl.xcm)) return -1;
if(xIl.xcm && (!this.xcm)) return 1;
var xmd=this.xEl(this.xVl, xIl.xVl);
if(this.xcm) xmd=-xmd;
return xmd;
}
p4.x4l=function(xIl)
{
var x1l=this.xcm;
if(xIl.xcm) x1l=!x1l;
var xql=this.xzm(this.xVl, xIl.xVl);
var xmd=new xEk();
xmd.xFm(xql,x1l);
return xmd;
}
p4.xZk=function(xIl)
{
var xfm=new xEk(this);
var xBk=xfm.xhm(xIl);

return [xfm,xBk];
}
p4.x5k=function(xIl)
{
var xmd=this.xZk(xIl);
return xmd[0];
}
p4.xSl=function(xIl)
{
var xmd=this.xZk(xIl);
return xmd[1];
}
p4.xbk=function(xIl)
{
return ((this.xVl == xIl.xVl) && (this.xcm == xIl.xcm));
}
p4.xrk=function(xSm)
{
this.xcm=(xSm < 0.0);
if(this.xcm)
{
xSm=-xSm;
}
this.xVl=this.xHl(xSm);
}
p4.x5l=function()
{
var xmd=this.xGl(this.xVl);
if( (!this.xpk()) && (this.xcm) )
{
xmd=-xmd;
}
return xmd;
}
p4.x3k=function()
{
if(this.xcm)
{
throw new Error("Not supported");
}
var x2l=new xEk(this);
var xYf;
var xmd=[];
var xem=new xEk("4294967296");
while(true)
{
xYf=x2l.xZk(xem);
x2l=xYf[0];
var x7k=x2l.xpk();
var xQl=xYf[1].x5l();
for(var i=0; i < 4; i++)
{
if(x7k && (xQl == 0)) break;
xmd.push(xQl & 0xff);
xQl >>= 8;
}
if(x7k) break;
}
xmd.reverse();

return xmd;
}

p4.xAk=function(xJk)
{
var xIm=3-((xJk.length+3)&3);
var xYf=[];
while(xIm-- > 0)
{
xYf.push(0);
}
xYf=xYf.concat(xJk);
var xmd=new xEk();
var xYk=new xEk("4294967296");
for(var xxl=0; xxl < xYf.length; xxl += 4)
{
xmd=xmd.x4l(xYk);
var xQl=(xYf[xxl]<<24) | (xYf[xxl+1]<<16) | (xYf[xxl+2]<<8) | (xYf[xxl+3]);
if(xQl < 0)
{
xQl += 0x100000000;
}
var xRl=new xEk(xQl);
xmd=xmd.xRl(xRl);
}
this.xOl(xmd);
}
p4.xsk=function(xPl, xRm)
{
if(this.xcm || xPl.xcm || xRm.xcm)
{
throw new Error("Negative");
}
var xUm=new xEk(this);
var xjm=new xEk("2");
var xEm=new xEk(xPl);
var xgk;
var xmd=new xEk("1");
while(true)
{
xgk=xEm.xhm(xjm);
if(!xgk.xpk())
{
xmd=xmd.x4l(xUm);
xmd=xmd.xSl(xRm);
}
if(xEm.xpk())
{
break;
}
xUm=xUm.x4l(xUm);
xUm=xUm.xSl(xRm);
}
return xmd;
}
p4.xCm=function()
{
return this.xcm;
}

var p5=xmn.prototype;
p5.x3m=null;
p5.xtn=null;
p5.xln=null;
function xmn()
{
}



p5.xen=function(xan, x0m)
{
var xxn=new xEk("1");
var xsf=xan.x4l(x0m);
var xqn=xan.x3l(xxn).x4l(x0m.x3l(xxn));
var xXb=new xEk(17);
var xbn=this.xYm(xXb,xqn);
var xBn=xbn[2];
if(!xBn.xbk(xxn))
{
if(!xqn.xSl(xBn).xpk())
{
throw new Error("internal error");
}
throw new Error("not coprime");
}
var xI=xbn[0];
if(xI.xCm())
{
xI=xI.xRl(xqn);
}
if(xI.xCm())
{
throw new Error("negative");
}
if(xI.xim(xqn) >= 0)
{
throw new Error("too large");
}
var xW=xI.x4l(xXb).xSl(xqn);
if(!xW.xbk(xxn))
{
throw new Error("failed2");
}
return [xXb,xI,xsf];
}
p5.xAn=function(xXm, xsf)
{
this.xtn=new xEk(xXm);
this.x3m=new xEk(xsf);
}
p5.x9m=function(xXm, xsf)
{
this.xln=new xEk(xXm);
this.x3m=new xEk(xsf);
}
p5.x5m=function()
{
return this.xtn;
}
p5.xzn=function()
{
return this.xln;
}
p5.xkn=function()
{
return this.x3m;
}
p5.xZm=function()
{
if( (!this.x3m) || (!this.xln) )
{
throw new Error("Need private key");
}
}
p5.xCn=function()
{
if( (!this.x3m) || (!this.xtn) )
{
throw new Error("Need public key");
}
}
p5.xDn=function(message)
{
this.xZm();
if(message.xim(this.x3m) >= 0)
{
throw new Error("Message too large");
}
return message.xsk(this.xln,this.x3m);
}
p5.xjn=function(message)
{
this.xCn();
if(message.xim(this.x3m) >= 0)
{
throw new Error("Message too large");
}
return message.xsk(this.xtn,this.x3m);
}

p5.xYm=function(xdn, xon)
{
var xHj=new xEk(xdn);
var xil=new xEk(xon);
var x=new xEk();
var y=new xEk("1");
var xwn=new xEk("1");
var x7m=new xEk();
while(!xil.xpk())
{
var x8m=xHj.xZk(xil);
var xfm=x8m[0];
xHj.xOl(xil);
xil=x8m[1];
var xnn=xwn.x3l(xfm.x4l(x));
var xin=x7m.x3l(xfm.x4l(y));
xwn=x;
x7m=y;
x=xnn;
y=xin;
}
var xW=xwn.x4l(xdn).xRl(x7m.x4l(xon));
if(!xW.xbk(xHj))
{
throw new Error("Failed3");
}
if(!xdn.xSl(xHj).xpk())
{
throw new Error("Failed4");
}
if(!xon.xSl(xHj).xpk())
{
throw new Error("Failed5");
}
return [xwn, x7m, xHj];
}

var p6=xbo.prototype;
function xbo()
{
}

p6.xUn=function(x7n)
{
this.x2n();
var xWn=x7n.length;
var xxl=0;
var x9n=xWn;
while(true)
{
if(x9n >= 64)
{
this.xqo(x7n.slice(xxl,xxl+64));
x9n -= 64;
xxl += 64;
}
else
{
this.xMn(x7n.slice(xxl,xxl+x9n),xWn);
break;
}
}
return this.x0n(this.xQn);
}
p6.xGn=function(s)
{
var x8n=this.xco(s);
this.xUn(x8n);
}
p6.x6n=function()
{
return this.x0n(this.xQn);
}
p6.xpo=function()
{
var x8n=this.x0n(this.xQn);
return this.xjo(x8n);
}
p6.xjo=function(xHj)
{
var xmd="";
for(var i=0; i < xHj.length; i++)
{
var xil=xHj[i];
for(var xLk=0; xLk < 2; xLk++)
{
var xho=(xil >> 4)&0x0f;
if(xho < 10)
{
xmd += String.fromCharCode(48+xho);
}
else
{
xmd += String.fromCharCode(87+xho);
}
xil <<= 4;
}
}
return xmd;
}
//////////// private: ///////////////
p6.x2n=function()
{
this.xQn=[0x67452301, 0xEFCDAB89, 0x98BADCFE, 0x10325476, 0xC3D2E1F0];
}
p6.xoo=function(xIn)
{
if(xIn.length != 16)
{
throw new Error("Should be 16");
}
var xrc=[];
var i;
for(i=0; i < 16; i++)
{
xrc[i]=xIn[i];
}
for(i=16; i < 80; i++)
{
xrc[i] = this.xko(xrc[i-3] ^ xrc[i-8] ^ xrc[i-14] ^ xrc[i-16], 1);
}
var xNn=this.xQn.slice(0);
var xSm, xHn, xSn;
for(i=0; i < 80; i++)
{
if(i < 20)
{
xSm = (xNn[1] & xNn[2]) | ((xNn[1]^0xffffffff) & xNn[3]);
xHn = 0x5A827999;
}
else if(i < 40)
{
xSm = xNn[1] ^ xNn[2] ^ xNn[3];
xHn = 0x6ED9EBA1;
}
else if(i < 60)
{
xSm = (xNn[1] & xNn[2]) | (xNn[1] & xNn[3]) | (xNn[2] & xNn[3]);
xHn = 0x8F1BBCDC;
}
else
{
xSm = xNn[1] ^ xNn[2] ^ xNn[3];
xHn = 0xCA62C1D6;
}
xSn = (this.xko(xNn[0], 5)+xSm+xNn[4]+xHn+xrc[i]) & 0xffffffff;
xNn[4] = xNn[3];
xNn[3] = xNn[2];
xNn[2] = this.xko(xNn[1], 30);
xNn[1] = xNn[0];
xNn[0] = xSn;
}
for(i=0; i < 5; i++)
{
xSn=this.xQn[i]+xNn[i];
xSn &= 0xffffffff;
this.xQn[i]=xSn;
}
}
p6.xqo=function(x7n)
{
if(x7n.length != 64)
{
throw new Error("Should be 64");
}
var xlo=this.xeo(x7n);
this.xoo(xlo);
}
p6.xMn=function(x7n, xdo)
{
var xLn=xdo & 63;
var xZn=x7n.slice(0,xLn);
xZn.push(128);
if(xZn.length < 56)
{
while(xZn.length < 56)
{
xZn.push(0);
}
}
else
{
while(xZn.length < 120)
{
xZn.push(0);
}
}
xdo *= 8;
var xgo=this.x0n([Math.floor(xdo/0x100000000), xdo&0xffffffff]);
xZn=xZn.concat(xgo);
if(xZn.length == 64)
{
this.xqo(xZn);
}
else
{
this.xqo(xZn.slice(0,64));
this.xqo(xZn.slice(64,128));
}
}
p6.xko=function(xil, xfo)
{
xil &= 0xffffffff;
var xmd=this.xRn(xil, xfo);
var xW=this.xRn(xmd, -xfo);
if(xil != xW)
{
throw new Error("Failed");
}
return xmd;
}
p6.xRn=function(xil, xfo)
{
xfo &= 31;
if(xfo == 0) return xil;
var xmd=(xil << xfo)&0xffffffff;
var x4n=32-xfo;
var xno=0x7fffffff >> (x4n-1);
var xao=(xil >> x4n)&xno;
xmd |= xao;
return xmd;
}
p6.xeo=function(x7n)
{
if(x7n.length & 3)
{
throw new Error("Should be multiple of 4");
}
var xlo=[];
var xrl=0;
var i=0;
while(i < x7n.length)
{
xrl <<= 8;
xrl |= (x7n[i] & 0xff);
i++;
if( (i & 3) == 0)
{
xlo.push(xrl);
xrl=0;
}
}
return xlo;
}
p6.x0n=function(xIn)
{
var x8n=[];
var xrc, i, xJn;
for(i=0; i < xIn.length; i++)
{
xrc=xIn[i];
x8n.push((xrc >> 24)&0xff);
x8n.push((xrc >> 16)&0xff);
x8n.push((xrc >> 8)&0xff);
x8n.push((xrc)&0xff);
}
return x8n;
}
p6.xco=function(s)
{
var xmd=[];
for(var i=0; i < s.length; i++)
{
xmd=xmd.concat(this.xio(s.charCodeAt(i)));
}
return xmd;
}
p6.xio=function(xTj)
{
var xmd;
if(xTj <= 0x7f)
{
xmd=[xTj];
}
else if(xTj <= 0x07ff)
{
xmd=[0xc0|((xTj>>6)&0x1f), 0x80|(xTj&0x3f)];
}
else if(xTj <= 0xffff)
{
xmd=[0xc0|((xTj>>12)&0x0f), 0x80|((xTj>>6)&0x3f), 0x80|(xTj&0x3f)];
}
else if(xTj <= 0x1fffff)
{
xmd=[0xc0|((xTj>>18)&0x07), 0x80|((xTj>>12)&0x3f), 0x80|((xTj>>6)&0x3f), 0x80|(xTj&0x3f)];
}
else if(xTj <= 0x3ffffff)
{
xmd=[0xc0|((xTj>>24)&0x03), 0x80|((xTj>>18)&0x3f), 0x80|((xTj>>12)&0x3f), 0x80|((xTj>>6)&0x3f), 0x80|(xTj&0x3f)];
}
else
{
xmd=[0xc0|((xTj>>30)&0x01), 0x80|((xTj>>24)&0x3f), 0x80|((xTj>>18)&0x3f), 0x80|((xTj>>12)&0x3f), 0x80|((xTj>>6)&0x3f), 0x80|(xTj&0x3f)];
}
return xmd;
}

var p7=xNo.prototype;
function xNo()
{
this.xuo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
}

p7.xJo=function(x8n)
{
var xmd="";
var xWn=x8n.length;
var xCc=0;
var xsl;
while(xCc < xWn)
{
xsl=xCc+3;
if(xsl > xWn) xsl=xWn;
xmd += this.xyo(x8n.slice(xCc,xsl));
xCc=xsl;
}

return xmd;
}
p7.xKo=function(xDl)
{
var xmd=[];
if( (xDl.length % 4) != 0)
{
this.xvo();
}
var xCc=0;
var xLo;
while(xCc < xDl.length)
{
xLo=this.xOo(xDl.substr(xCc,4));
xmd=xmd.concat(xLo);
xCc += 4;
}
return xmd;
}
p7.xyo=function(x8n)
{
var xmd="";
var xho=x8n[0] >> 2;
xmd += this.xuo.substr(xho,1);
var xil;
if(x8n.length < 2)
{
xil=0;
}
else
{
xil=x8n[1];
}
xho=((x8n[0] & 0x03) << 4) | (xil >> 4);
xmd += this.xuo.substr(xho,1);
if(x8n.length < 2)
{
xmd +="==";
}
else
{
if(x8n.length < 3)
{
xil=0;
}
else
{
xil=x8n[2];
}
xho=((x8n[1] & 0x0f) << 2) | (xil >> 6);
xmd += this.xuo.substr(xho,1);
if(x8n.length < 3)
{
xmd +="=";
}
else
{
xho=xil & 0x3f;
xmd += this.xuo.substr(xho,1);
}
}
return xmd;
}
p7.xOo=function(xDl)
{
if(xDl.length != 4)
{
this.xvo();
}
var xmd=[];
var xIo=this.xPo(xDl.charCodeAt(0));
var xMo=this.xPo(xDl.charCodeAt(1));
xmd[0]=(xIo << 2) | (xMo >> 4);
var i=xDl.charCodeAt(2);
if(i != 61)
{
xIo=xMo;
xMo=this.xPo(i);
xmd[1]=((xIo & 0x0f) << 4) | (xMo >> 2);
i=xDl.charCodeAt(3);
if(i != 61)
{
xIo=xMo;
xMo=this.xPo(i);
xmd[2]=((xIo & 0x03) << 6) | xMo;
}
}
return xmd;
}
p7.xPo=function(xHo)
{
if( (xHo >= 65) && (xHo <= 90))
{
return xHo-65;
}
else if( (xHo >= 97) && (xHo <= 122))
{
return xHo-71;
}
else if( (xHo >= 48) && (xHo <= 57))
{
return xHo+4;
}
else if(xHo == 43)
{
return 62;
}
else if(xHo == 47)
{
return 63;
}
this.xvo();
return 0;
}
p7.xvo=function()
{
throw new Error("Faulty Base64 data");
}

var p8=xep.prototype;
function xep()
{
this.xgp=new xmn();
this.xRo=new xbo();
this.xVo=new xNo();
}

p8.xTo=function(message, x5o)
{
this.xgp.xZm();
if(x5o)
{
this.xgp.xCn();
}
this.xRo.xGn(message);
var x5n=this.xRo.x6n();
var xsf=this.xgp.xkn();
var x2o=xsf.x3k();
var x1o=x2o.length-1;
if(x5n.length > x1o)
{
throw new Error("Key too short");
}
var xbp="";
while(x5n.length < x1o)
{
var xZb=Math.floor(Math.random()*255);
x5n[x5n.length]=xZb;
xbp += xZb+",";
}
var x4o=new xEk();
x4o.xAk(x5n);
var x6m=this.xgp.xDn(x4o);
if(x5o)
{
var x3o=this.xgp.xjn(x6m);
if(! x3o.xbk(x4o))
{
throw new Error("Internal error");
}
}
var x0o=x6m.x3k();
var x6o=this.xVo.xJo(x0o);
return x6o;
}
p8.x5o=function(message, xJf)
{
this.xgp.xCn();
var xXo=this.xVo.xKo(xJf);
var xcp=new xEk();
xcp.xAk(xXo);
var x3o=this.xgp.xjn(xcp);
var xap=x3o.x3k();
this.xRo.xGn(message);
var x5n=this.xRo.x6n();
if(xap.length < x5n.length) return false;
for(var i=0; i < x5n.length; i++)
{
if(xap[i] != x5n[i]) return false;
}
return true;
}
p8.xAn=function(xXm, xsf)
{
this.xgp.xAn(xXm, xsf);
}
p8.x9m=function(xXm, xsf)
{
this.xgp.x9m(xXm, xsf);
}

